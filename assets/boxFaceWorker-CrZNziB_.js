var Q=1e-6,L=typeof Float32Array<"u"?Float32Array:Array,R=Math.random;Math.hypot||(Math.hypot=function(){for(var n=0,r=arguments.length;r--;)n+=arguments[r]*arguments[r];return Math.sqrt(n)});function _(){var n=new L(3);return L!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n}function B(n){var r=new L(3);return r[0]=n[0],r[1]=n[1],r[2]=n[2],r}function U(n){var r=n[0],e=n[1],t=n[2];return Math.hypot(r,e,t)}function D(n,r,e){var t=new L(3);return t[0]=n,t[1]=r,t[2]=e,t}function C(n,r){return n[0]=r[0],n[1]=r[1],n[2]=r[2],n}function J(n,r,e,t){return n[0]=r,n[1]=e,n[2]=t,n}function K(n,r,e){return n[0]=r[0]+e[0],n[1]=r[1]+e[1],n[2]=r[2]+e[2],n}function X(n,r,e){return n[0]=r[0]-e[0],n[1]=r[1]-e[1],n[2]=r[2]-e[2],n}function j(n,r,e){return n[0]=r[0]*e[0],n[1]=r[1]*e[1],n[2]=r[2]*e[2],n}function Z(n,r,e){return n[0]=r[0]/e[0],n[1]=r[1]/e[1],n[2]=r[2]/e[2],n}function W(n,r){return n[0]=Math.ceil(r[0]),n[1]=Math.ceil(r[1]),n[2]=Math.ceil(r[2]),n}function S(n,r){return n[0]=Math.floor(r[0]),n[1]=Math.floor(r[1]),n[2]=Math.floor(r[2]),n}function b(n,r,e){return n[0]=Math.min(r[0],e[0]),n[1]=Math.min(r[1],e[1]),n[2]=Math.min(r[2],e[2]),n}function nn(n,r,e){return n[0]=Math.max(r[0],e[0]),n[1]=Math.max(r[1],e[1]),n[2]=Math.max(r[2],e[2]),n}function rn(n,r){return n[0]=Math.round(r[0]),n[1]=Math.round(r[1]),n[2]=Math.round(r[2]),n}function en(n,r,e){return n[0]=r[0]*e,n[1]=r[1]*e,n[2]=r[2]*e,n}function tn(n,r,e,t){return n[0]=r[0]+e[0]*t,n[1]=r[1]+e[1]*t,n[2]=r[2]+e[2]*t,n}function $(n,r){var e=r[0]-n[0],t=r[1]-n[1],a=r[2]-n[2];return Math.hypot(e,t,a)}function G(n,r){var e=r[0]-n[0],t=r[1]-n[1],a=r[2]-n[2];return e*e+t*t+a*a}function H(n){var r=n[0],e=n[1],t=n[2];return r*r+e*e+t*t}function an(n,r){return n[0]=-r[0],n[1]=-r[1],n[2]=-r[2],n}function cn(n,r){return n[0]=1/r[0],n[1]=1/r[1],n[2]=1/r[2],n}function E(n,r){var e=r[0],t=r[1],a=r[2],c=e*e+t*t+a*a;return c>0&&(c=1/Math.sqrt(c)),n[0]=r[0]*c,n[1]=r[1]*c,n[2]=r[2]*c,n}function Y(n,r){return n[0]*r[0]+n[1]*r[1]+n[2]*r[2]}function N(n,r,e){var t=r[0],a=r[1],c=r[2],s=e[0],o=e[1],i=e[2];return n[0]=a*i-c*o,n[1]=c*s-t*i,n[2]=t*o-a*s,n}function sn(n,r,e,t){var a=r[0],c=r[1],s=r[2];return n[0]=a+t*(e[0]-a),n[1]=c+t*(e[1]-c),n[2]=s+t*(e[2]-s),n}function on(n,r,e,t,a,c){var s=c*c,o=s*(2*c-3)+1,i=s*(c-2)+c,v=s*(c-1),h=s*(3-2*c);return n[0]=r[0]*o+e[0]*i+t[0]*v+a[0]*h,n[1]=r[1]*o+e[1]*i+t[1]*v+a[1]*h,n[2]=r[2]*o+e[2]*i+t[2]*v+a[2]*h,n}function fn(n,r,e,t,a,c){var s=1-c,o=s*s,i=c*c,v=o*s,h=3*c*o,l=3*i*s,M=i*c;return n[0]=r[0]*v+e[0]*h+t[0]*l+a[0]*M,n[1]=r[1]*v+e[1]*h+t[1]*l+a[1]*M,n[2]=r[2]*v+e[2]*h+t[2]*l+a[2]*M,n}function ln(n,r){r=r||1;var e=R()*2*Math.PI,t=R()*2-1,a=Math.sqrt(1-t*t)*r;return n[0]=Math.cos(e)*a,n[1]=Math.sin(e)*a,n[2]=t*r,n}function vn(n,r,e){var t=r[0],a=r[1],c=r[2],s=e[3]*t+e[7]*a+e[11]*c+e[15];return s=s||1,n[0]=(e[0]*t+e[4]*a+e[8]*c+e[12])/s,n[1]=(e[1]*t+e[5]*a+e[9]*c+e[13])/s,n[2]=(e[2]*t+e[6]*a+e[10]*c+e[14])/s,n}function Mn(n,r,e){var t=r[0],a=r[1],c=r[2];return n[0]=t*e[0]+a*e[3]+c*e[6],n[1]=t*e[1]+a*e[4]+c*e[7],n[2]=t*e[2]+a*e[5]+c*e[8],n}function hn(n,r,e){var t=e[0],a=e[1],c=e[2],s=e[3],o=r[0],i=r[1],v=r[2],h=a*v-c*i,l=c*o-t*v,M=t*i-a*o,g=a*M-c*l,q=c*h-t*M,y=t*l-a*h,u=s*2;return h*=u,l*=u,M*=u,g*=2,q*=2,y*=2,n[0]=o+h+g,n[1]=i+l+q,n[2]=v+M+y,n}function un(n,r,e,t){var a=[],c=[];return a[0]=r[0]-e[0],a[1]=r[1]-e[1],a[2]=r[2]-e[2],c[0]=a[0],c[1]=a[1]*Math.cos(t)-a[2]*Math.sin(t),c[2]=a[1]*Math.sin(t)+a[2]*Math.cos(t),n[0]=c[0]+e[0],n[1]=c[1]+e[1],n[2]=c[2]+e[2],n}function dn(n,r,e,t){var a=[],c=[];return a[0]=r[0]-e[0],a[1]=r[1]-e[1],a[2]=r[2]-e[2],c[0]=a[2]*Math.sin(t)+a[0]*Math.cos(t),c[1]=a[1],c[2]=a[2]*Math.cos(t)-a[0]*Math.sin(t),n[0]=c[0]+e[0],n[1]=c[1]+e[1],n[2]=c[2]+e[2],n}function mn(n,r,e,t){var a=[],c=[];return a[0]=r[0]-e[0],a[1]=r[1]-e[1],a[2]=r[2]-e[2],c[0]=a[0]*Math.cos(t)-a[1]*Math.sin(t),c[1]=a[0]*Math.sin(t)+a[1]*Math.cos(t),c[2]=a[2],n[0]=c[0]+e[0],n[1]=c[1]+e[1],n[2]=c[2]+e[2],n}function xn(n,r){var e=n[0],t=n[1],a=n[2],c=r[0],s=r[1],o=r[2],i=Math.sqrt(e*e+t*t+a*a),v=Math.sqrt(c*c+s*s+o*o),h=i*v,l=h&&Y(n,r)/h;return Math.acos(Math.min(Math.max(l,-1),1))}function yn(n){return n[0]=0,n[1]=0,n[2]=0,n}function gn(n){return"vec3("+n[0]+", "+n[1]+", "+n[2]+")"}function zn(n,r){return n[0]===r[0]&&n[1]===r[1]&&n[2]===r[2]}function An(n,r){var e=n[0],t=n[1],a=n[2],c=r[0],s=r[1],o=r[2];return Math.abs(e-c)<=Q*Math.max(1,Math.abs(e),Math.abs(c))&&Math.abs(t-s)<=Q*Math.max(1,Math.abs(t),Math.abs(s))&&Math.abs(a-o)<=Q*Math.max(1,Math.abs(a),Math.abs(o))}var k=X,qn=j,In=Z,wn=$,Vn=G,pn=U,Fn=H,Pn=function(){var n=_();return function(r,e,t,a,c,s){var o,i;for(e||(e=3),t||(t=0),a?i=Math.min(a*e+t,r.length):i=r.length,o=t;o<i;o+=e)n[0]=r[o],n[1]=r[o+1],n[2]=r[o+2],c(n,n,s),r[o]=n[0],r[o+1]=n[1],r[o+2]=n[2];return r}}(),Tn=Object.freeze({__proto__:null,add:K,angle:xn,bezier:fn,ceil:W,clone:B,copy:C,create:_,cross:N,dist:wn,distance:$,div:In,divide:Z,dot:Y,equals:An,exactEquals:zn,floor:S,forEach:Pn,fromValues:D,hermite:on,inverse:cn,len:pn,length:U,lerp:sn,max:nn,min:b,mul:qn,multiply:j,negate:an,normalize:E,random:ln,rotateX:un,rotateY:dn,rotateZ:mn,round:rn,scale:en,scaleAndAdd:tn,set:J,sqrDist:Vn,sqrLen:Fn,squaredDistance:G,squaredLength:H,str:gn,sub:k,subtract:X,transformMat3:Mn,transformMat4:vn,transformQuat:hn,zero:yn}),Dn=Object.freeze({__proto__:null,vec3:Tn});function _n(n,r,e){const t=B(n),a=B(r);E(t,t),E(a,a);const c=Math.abs(t[0])<.9?D(1,0,0):D(0,1,0),s=N(_(),t,c);E(s,s);const o=Y(a,s),i=N(_(),s,a),v=Y(i,t),l=(Math.atan2(v,o)+Math.PI)/(2*Math.PI),M=Math.round(l*32767)&32767;return(e>0?1:0)<<15|M}function En(n,r,e,t,a,c,s){const o=new Uint16Array(n*8),i=D(1/0,1/0,1/0),v=D(-1/0,-1/0,-1/0);if(!c||!s)for(let l=0;l<r.length;l+=3)i[0]=Math.min(i[0],r[l]),i[1]=Math.min(i[1],r[l+1]),i[2]=Math.min(i[2],r[l+2]),v[0]=Math.max(v[0],r[l]),v[1]=Math.max(v[1],r[l+1]),v[2]=Math.max(v[2],r[l+2]);else C(i,c),C(v,s);const h=k(_(),v,i);for(let l=0;l<n;l++){const M=l*3,g=l*4,q=l*2,y=l*8,u=(r[M]-i[0])/h[0],m=(r[M+1]-i[1])/h[1],x=(r[M+2]-i[2])/h[2];o[y]=u*65535,o[y+1]=m*65535,o[y+2]=x*65535;const z=D(e[M],e[M+1],e[M+2]),d=D(t[g],t[g+1],t[g+2]),I=t[g+3]>0?1:0,A=_n(z,d,I);o[y+3]=A;const P=e[M],F=e[M+1],w=e[M+2],p=1/(Math.abs(P)+Math.abs(F)+Math.abs(w));let V=P*p,T=F*p;if(w<0){const O=V;V=(1-Math.abs(T))*(V>=0?1:-1),T=(1-Math.abs(O))*(T>=0?1:-1)}o[y+4]=(V*.5+.5)*65535|0,o[y+5]=(T*.5+.5)*65535|0,o[y+6]=a[q]*65535|0,o[y+7]=a[q+1]*65535|0}return{compressedData:o,positionMin:i,positionMax:v}}let f;(async()=>f=(await Promise.resolve().then(function(){return Dn})).vec3)();function Ln(n,r,e,t,a,c,s,o,i,v,h){const l=v*h;let M=f.create(),g=f.create(),q=f.create(),y=f.create();for(let u=0;u<c;u++)for(let m=0;m<s;m++){f.scaleAndAdd(M,n,r,t*u/c),f.scaleAndAdd(M,M,e,a*m/s),f.scaleAndAdd(g,M,r,t/c),f.scaleAndAdd(q,g,e,a/s),f.scaleAndAdd(y,M,e,a/s);const x=u*s+m,z=x*4,d=z*3;i[d+0]=M[0],i[d+1]=M[1],i[d+2]=M[2],i[d+3]=g[0],i[d+4]=g[1],i[d+5]=g[2],i[d+6]=q[0],i[d+7]=q[1],i[d+8]=q[2],i[d+9]=y[0],i[d+10]=y[1],i[d+11]=y[2];const I=x*6;o[I+0]=l+z+0,o[I+1]=l+z+2,o[I+2]=l+z+1,o[I+3]=l+z+0,o[I+4]=l+z+3,o[I+5]=l+z+2}}function Yn(n,r,e,t,a,c,s,o,i,v,h,l,M){const g=s.length/3,q=f.length(f.multiply(f.create(),r,t)),y=f.length(f.multiply(f.create(),e,t));n=f.multiply(f.create(),n,t),Ln(n,r,e,q,y,c,c,h,s,M,g);{const u=f.create(),m=f.create(),x=f.create(),z=f.create(),d=f.create(),I=f.scale(f.create(),t,.5),A=f.subtract(f.create(),I,[a,a,a]),P=f.negate(f.create(),A);for(let F=0;F<g;F++){const w=F*3,p=F*2,V=F*4;u[0]=s[w],u[1]=s[w+1],u[2]=s[w+2],f.max(d,P,u),f.min(d,A,d),f.subtract(m,u,d),f.normalize(m,m),f.scaleAndAdd(u,d,m,a),s[w]=u[0],s[w+1]=u[1],s[w+2]=u[2],v[p]=u[l[0]]/t[l[0]]+.5,v[p+1]=u[l[1]]/t[l[1]]+.5,o[w]=m[0],o[w+1]=m[1],o[w+2]=m[2],f.copy(x,r),f.normalize(x,x);const T=f.dot(x,m);f.scaleAndAdd(x,x,m,-T),f.normalize(x,x),f.cross(z,m,x);const O=f.dot(z,e)>0?1:-1;i[V]=x[0],i[V+1]=x[1],i[V+2]=x[2],i[V+3]=O}}}self.onmessage=async n=>{for(;!f;)await new Promise(p=>setTimeout(p,10));const r=performance.now(),{start:e,right:t,up:a,uvIndex:c,size:s,radius:o,resolution:i,faceIndex:v,numVerticesPerFace:h,numIndicesPerFace:l,quantize:M}=n.data,g=f.fromValues(e[0],e[1],e[2]),q=f.fromValues(t[0],t[1],t[2]),y=f.fromValues(a[0],a[1],a[2]),u=f.fromValues(s[0],s[1],s[2]),m=new Float32Array(h*3),x=new Float32Array(h*3),z=new Float32Array(h*4),d=new Float32Array(h*2),I=new Uint32Array(l);Yn(g,q,y,u,o,i,m,x,z,d,I,c,v);let A={indices:I,numVertices:h,vertexBytes:0};const P=[I.buffer];if(M){let p=f.scale(f.create(),u,.5),V=f.negate(f.create(),p);const T=En(h,m,x,z,d,V,p);A.quantizedData=T.compressedData,A.positionMin=f.clone(V),A.positionMax=f.clone(p),A.vertexBytes=16,P.push(A.quantizedData.buffer)}else A.positions=m,A.normals=x,A.tangents=z,A.uvs=d,A.vertexBytes=3*4+3*4+4*4+2*4,P.push(m.buffer,x.buffer,z.buffer,d.buffer);const w=(performance.now()-r).toFixed(2);console.log(`Face generation time: ${w} milliseconds`),self.postMessage({faceIndex:v,...A},{transfer:P})};
//# sourceMappingURL=boxFaceWorker-CrZNziB_.js.map
