var Y=1e-6,R=typeof Float32Array<"u"?Float32Array:Array,X=Math.random;Math.hypot||(Math.hypot=function(){for(var n=0,t=arguments.length;t--;)n+=arguments[t]*arguments[t];return Math.sqrt(n)});function T(){var n=new R(3);return R!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n}function L(n){var t=new R(3);return t[0]=n[0],t[1]=n[1],t[2]=n[2],t}function j(n){var t=n[0],e=n[1],r=n[2];return Math.hypot(t,e,r)}function P(n,t,e){var r=new R(3);return r[0]=n,r[1]=t,r[2]=e,r}function Q(n,t){return n[0]=t[0],n[1]=t[1],n[2]=t[2],n}function b(n,t,e,r){return n[0]=t,n[1]=e,n[2]=r,n}function nn(n,t,e){return n[0]=t[0]+e[0],n[1]=t[1]+e[1],n[2]=t[2]+e[2],n}function S(n,t,e){return n[0]=t[0]-e[0],n[1]=t[1]-e[1],n[2]=t[2]-e[2],n}function Z(n,t,e){return n[0]=t[0]*e[0],n[1]=t[1]*e[1],n[2]=t[2]*e[2],n}function $(n,t,e){return n[0]=t[0]/e[0],n[1]=t[1]/e[1],n[2]=t[2]/e[2],n}function tn(n,t){return n[0]=Math.ceil(t[0]),n[1]=Math.ceil(t[1]),n[2]=Math.ceil(t[2]),n}function en(n,t){return n[0]=Math.floor(t[0]),n[1]=Math.floor(t[1]),n[2]=Math.floor(t[2]),n}function rn(n,t,e){return n[0]=Math.min(t[0],e[0]),n[1]=Math.min(t[1],e[1]),n[2]=Math.min(t[2],e[2]),n}function an(n,t,e){return n[0]=Math.max(t[0],e[0]),n[1]=Math.max(t[1],e[1]),n[2]=Math.max(t[2],e[2]),n}function cn(n,t){return n[0]=Math.round(t[0]),n[1]=Math.round(t[1]),n[2]=Math.round(t[2]),n}function N(n,t,e){return n[0]=t[0]*e,n[1]=t[1]*e,n[2]=t[2]*e,n}function U(n,t,e,r){return n[0]=t[0]+e[0]*r,n[1]=t[1]+e[1]*r,n[2]=t[2]+e[2]*r,n}function G(n,t){var e=t[0]-n[0],r=t[1]-n[1],a=t[2]-n[2];return Math.hypot(e,r,a)}function H(n,t){var e=t[0]-n[0],r=t[1]-n[1],a=t[2]-n[2];return e*e+r*r+a*a}function k(n){var t=n[0],e=n[1],r=n[2];return t*t+e*e+r*r}function on(n,t){return n[0]=-t[0],n[1]=-t[1],n[2]=-t[2],n}function sn(n,t){return n[0]=1/t[0],n[1]=1/t[1],n[2]=1/t[2],n}function F(n,t){var e=t[0],r=t[1],a=t[2],c=e*e+r*r+a*a;return c>0&&(c=1/Math.sqrt(c)),n[0]=t[0]*c,n[1]=t[1]*c,n[2]=t[2]*c,n}function C(n,t){return n[0]*t[0]+n[1]*t[1]+n[2]*t[2]}function _(n,t,e){var r=t[0],a=t[1],c=t[2],s=e[0],o=e[1],i=e[2];return n[0]=a*i-c*o,n[1]=c*s-r*i,n[2]=r*o-a*s,n}function ln(n,t,e,r){var a=t[0],c=t[1],s=t[2];return n[0]=a+r*(e[0]-a),n[1]=c+r*(e[1]-c),n[2]=s+r*(e[2]-s),n}function fn(n,t,e,r,a,c){var s=c*c,o=s*(2*c-3)+1,i=s*(c-2)+c,M=s*(c-1),d=s*(3-2*c);return n[0]=t[0]*o+e[0]*i+r[0]*M+a[0]*d,n[1]=t[1]*o+e[1]*i+r[1]*M+a[1]*d,n[2]=t[2]*o+e[2]*i+r[2]*M+a[2]*d,n}function dn(n,t,e,r,a,c){var s=1-c,o=s*s,i=c*c,M=o*s,d=3*c*o,f=3*i*s,h=i*c;return n[0]=t[0]*M+e[0]*d+r[0]*f+a[0]*h,n[1]=t[1]*M+e[1]*d+r[1]*f+a[1]*h,n[2]=t[2]*M+e[2]*d+r[2]*f+a[2]*h,n}function Mn(n,t){t=t||1;var e=X()*2*Math.PI,r=X()*2-1,a=Math.sqrt(1-r*r)*t;return n[0]=Math.cos(e)*a,n[1]=Math.sin(e)*a,n[2]=r*t,n}function hn(n,t,e){var r=t[0],a=t[1],c=t[2],s=e[3]*r+e[7]*a+e[11]*c+e[15];return s=s||1,n[0]=(e[0]*r+e[4]*a+e[8]*c+e[12])/s,n[1]=(e[1]*r+e[5]*a+e[9]*c+e[13])/s,n[2]=(e[2]*r+e[6]*a+e[10]*c+e[14])/s,n}function un(n,t,e){var r=t[0],a=t[1],c=t[2];return n[0]=r*e[0]+a*e[3]+c*e[6],n[1]=r*e[1]+a*e[4]+c*e[7],n[2]=r*e[2]+a*e[5]+c*e[8],n}function vn(n,t,e){var r=e[0],a=e[1],c=e[2],s=e[3],o=t[0],i=t[1],M=t[2],d=a*M-c*i,f=c*o-r*M,h=r*i-a*o,x=a*h-c*f,p=c*d-r*h,y=r*f-a*d,u=s*2;return d*=u,f*=u,h*=u,x*=2,p*=2,y*=2,n[0]=o+d+x,n[1]=i+f+p,n[2]=M+h+y,n}function gn(n,t,e,r){var a=[],c=[];return a[0]=t[0]-e[0],a[1]=t[1]-e[1],a[2]=t[2]-e[2],c[0]=a[0],c[1]=a[1]*Math.cos(r)-a[2]*Math.sin(r),c[2]=a[1]*Math.sin(r)+a[2]*Math.cos(r),n[0]=c[0]+e[0],n[1]=c[1]+e[1],n[2]=c[2]+e[2],n}function mn(n,t,e,r){var a=[],c=[];return a[0]=t[0]-e[0],a[1]=t[1]-e[1],a[2]=t[2]-e[2],c[0]=a[2]*Math.sin(r)+a[0]*Math.cos(r),c[1]=a[1],c[2]=a[2]*Math.cos(r)-a[0]*Math.sin(r),n[0]=c[0]+e[0],n[1]=c[1]+e[1],n[2]=c[2]+e[2],n}function yn(n,t,e,r){var a=[],c=[];return a[0]=t[0]-e[0],a[1]=t[1]-e[1],a[2]=t[2]-e[2],c[0]=a[0]*Math.cos(r)-a[1]*Math.sin(r),c[1]=a[0]*Math.sin(r)+a[1]*Math.cos(r),c[2]=a[2],n[0]=c[0]+e[0],n[1]=c[1]+e[1],n[2]=c[2]+e[2],n}function xn(n,t){var e=n[0],r=n[1],a=n[2],c=t[0],s=t[1],o=t[2],i=Math.sqrt(e*e+r*r+a*a),M=Math.sqrt(c*c+s*s+o*o),d=i*M,f=d&&C(n,t)/d;return Math.acos(Math.min(Math.max(f,-1),1))}function zn(n){return n[0]=0,n[1]=0,n[2]=0,n}function An(n){return"vec3("+n[0]+", "+n[1]+", "+n[2]+")"}function pn(n,t){return n[0]===t[0]&&n[1]===t[1]&&n[2]===t[2]}function In(n,t){var e=n[0],r=n[1],a=n[2],c=t[0],s=t[1],o=t[2];return Math.abs(e-c)<=Y*Math.max(1,Math.abs(e),Math.abs(c))&&Math.abs(r-s)<=Y*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(a-o)<=Y*Math.max(1,Math.abs(a),Math.abs(o))}var J=S,qn=Z,Pn=$,wn=G,Vn=H,Tn=j,Fn=k,On=function(){var n=T();return function(t,e,r,a,c,s){var o,i;for(e||(e=3),r||(r=0),a?i=Math.min(a*e+r,t.length):i=t.length,o=r;o<i;o+=e)n[0]=t[o],n[1]=t[o+1],n[2]=t[o+2],c(n,n,s),t[o]=n[0],t[o+1]=n[1],t[o+2]=n[2];return t}}(),Dn=Object.freeze({__proto__:null,add:nn,angle:xn,bezier:dn,ceil:tn,clone:L,copy:Q,create:T,cross:_,dist:wn,distance:G,div:Pn,divide:$,dot:C,equals:In,exactEquals:pn,floor:en,forEach:On,fromValues:P,hermite:fn,inverse:sn,len:Tn,length:j,lerp:ln,max:an,min:rn,mul:qn,multiply:Z,negate:on,normalize:F,random:Mn,rotateX:gn,rotateY:mn,rotateZ:yn,round:cn,scale:N,scaleAndAdd:U,set:b,sqrDist:Vn,sqrLen:Fn,squaredDistance:H,squaredLength:k,str:An,sub:J,subtract:S,transformMat3:un,transformMat4:hn,transformQuat:vn,zero:zn}),En=Object.freeze({__proto__:null,vec3:Dn});function K(n,t,e){const r=L(n),a=L(t);F(r,r),F(a,a);const c=Math.abs(r[0])<.9?P(1,0,0):P(0,1,0),s=_(T(),r,c);F(s,s);const o=C(a,s),i=_(T(),s,a),M=C(i,r),f=(Math.atan2(M,o)+Math.PI)/(2*Math.PI),h=Math.round(f*32767)&32767;return(e>0?1:0)<<15|h}function W(n){n=n%(2*Math.PI),n>Math.PI?n-=2*Math.PI:n<-Math.PI&&(n+=2*Math.PI);const t=-.16666667,e=.008333333,r=-198413e-9,a=n*n,c=a*n;return n+t*c+e*c*a+r*c*a*a}function _n(n){return W(n+Math.PI/2)}function Cn(n,t){const e=L(t);F(e,e);const r=n>>15&1,c=(n&32767)/32767*(2*Math.PI)-Math.PI,s=Math.abs(e[0])<.9?P(1,0,0):P(0,1,0),o=_(T(),e,s);F(o,o);const i=_n(c),M=W(c),d=T(),f=T();return N(d,o,i),_(f,e,o),U(d,d,f,M),F(d,d),[d,r]}function Ln(n,t){const e=L(t);F(e,e);const r=n>>15&1,c=(n&32767)/32767*(2*Math.PI)-Math.PI,s=Math.abs(e[0])<.9?P(1,0,0):P(0,1,0),o=_(T(),e,s);F(o,o);const i=Math.cos(c),M=Math.sin(c),d=T(),f=T();return N(d,o,i),_(f,e,o),U(d,d,f,M),F(d,d),[d,r]}function Rn(n,t,e){const r=K(n,t,e),[a,c]=Ln(r,n),[s,o]=Cn(r,n),i=C(t,a),M=Math.acos(Math.min(1,Math.max(-1,i)));console.log("Encoding test results:"),console.log("Original tangent:",Array.from(t)),console.log("Regular Decoded tangent:",Array.from(a)),console.log("Regular Angle error (radians):",M),console.log("Regular Sign preserved:",e===c);const d=C(t,s),f=Math.acos(Math.min(1,Math.max(-1,d)));console.log("Optimized Decoded tangent:",Array.from(s)),console.log("Optimized Angle error (radians):",f),console.log("Optimized Sign preserved:",e===o)}{const n=P(0,1,0),t=P(1,0,0);Rn(n,t,1)}function Bn(n,t,e,r,a,c,s){const o=new Uint16Array(n*8),i=P(1/0,1/0,1/0),M=P(-1/0,-1/0,-1/0);if(!c||!s)for(let f=0;f<t.length;f+=3)i[0]=Math.min(i[0],t[f]),i[1]=Math.min(i[1],t[f+1]),i[2]=Math.min(i[2],t[f+2]),M[0]=Math.max(M[0],t[f]),M[1]=Math.max(M[1],t[f+1]),M[2]=Math.max(M[2],t[f+2]);else Q(i,c),Q(M,s);const d=J(T(),M,i);for(let f=0;f<n;f++){const h=f*3,x=f*4,p=f*2,y=f*8,u=(t[h]-i[0])/d[0],g=(t[h+1]-i[1])/d[1],m=(t[h+2]-i[2])/d[2];o[y]=u*65535,o[y+1]=g*65535,o[y+2]=m*65535;const z=P(e[h],e[h+1],e[h+2]),v=P(r[x],r[x+1],r[x+2]),I=r[x+3]>0?1:0,A=K(z,v,I);o[y+3]=A;const D=e[h],O=e[h+1],q=e[h+2],V=1/(Math.abs(D)+Math.abs(O)+Math.abs(q));let w=D*V,E=O*V;if(q<0){const B=w;w=(1-Math.abs(E))*(w>=0?1:-1),E=(1-Math.abs(B))*(E>=0?1:-1)}o[y+4]=(w*.5+.5)*65535|0,o[y+5]=(E*.5+.5)*65535|0,o[y+6]=a[p]*65535|0,o[y+7]=a[p+1]*65535|0}return{compressedData:o,positionMin:i,positionMax:M}}let l;(async()=>l=(await Promise.resolve().then(function(){return En})).vec3)();function Yn(n,t,e,r,a,c,s,o,i,M,d){const f=M*d;let h=l.create(),x=l.create(),p=l.create(),y=l.create();for(let u=0;u<c;u++)for(let g=0;g<s;g++){l.scaleAndAdd(h,n,t,r*u/c),l.scaleAndAdd(h,h,e,a*g/s),l.scaleAndAdd(x,h,t,r/c),l.scaleAndAdd(p,x,e,a/s),l.scaleAndAdd(y,h,e,a/s);const m=u*s+g,z=m*4,v=z*3;i[v+0]=h[0],i[v+1]=h[1],i[v+2]=h[2],i[v+3]=x[0],i[v+4]=x[1],i[v+5]=x[2],i[v+6]=p[0],i[v+7]=p[1],i[v+8]=p[2],i[v+9]=y[0],i[v+10]=y[1],i[v+11]=y[2];const I=m*6;o[I+0]=f+z+0,o[I+1]=f+z+2,o[I+2]=f+z+1,o[I+3]=f+z+0,o[I+4]=f+z+3,o[I+5]=f+z+2}}function Qn(n,t,e,r,a,c,s,o,i,M,d,f,h){const x=s.length/3,p=l.length(l.multiply(l.create(),t,r)),y=l.length(l.multiply(l.create(),e,r));n=l.multiply(l.create(),n,r),Yn(n,t,e,p,y,c,c,d,s,h,x);{const u=l.create(),g=l.create(),m=l.create(),z=l.create(),v=l.create(),I=l.scale(l.create(),r,.5),A=l.subtract(l.create(),I,[a,a,a]),D=l.negate(l.create(),A);for(let O=0;O<x;O++){const q=O*3,V=O*2,w=O*4;u[0]=s[q],u[1]=s[q+1],u[2]=s[q+2],l.max(v,D,u),l.min(v,A,v),l.subtract(g,u,v),l.normalize(g,g),l.scaleAndAdd(u,v,g,a),s[q]=u[0],s[q+1]=u[1],s[q+2]=u[2],M[V]=u[f[0]]/r[f[0]]+.5,M[V+1]=u[f[1]]/r[f[1]]+.5,o[q]=g[0],o[q+1]=g[1],o[q+2]=g[2],l.copy(m,t),l.normalize(m,m);const E=l.dot(m,g);l.scaleAndAdd(m,m,g,-E),l.normalize(m,m),l.cross(z,g,m);const B=l.dot(z,e)>0?1:-1;i[w]=m[0],i[w+1]=m[1],i[w+2]=m[2],i[w+3]=B}}}self.onmessage=async n=>{for(;!l;)await new Promise(V=>setTimeout(V,10));const t=performance.now(),{start:e,right:r,up:a,uvIndex:c,size:s,radius:o,resolution:i,faceIndex:M,numVerticesPerFace:d,numIndicesPerFace:f,quantize:h}=n.data,x=l.fromValues(e[0],e[1],e[2]),p=l.fromValues(r[0],r[1],r[2]),y=l.fromValues(a[0],a[1],a[2]),u=l.fromValues(s[0],s[1],s[2]),g=new Float32Array(d*3),m=new Float32Array(d*3),z=new Float32Array(d*4),v=new Float32Array(d*2),I=new Uint32Array(f);Qn(x,p,y,u,o,i,g,m,z,v,I,c,M);let A={indices:I,numVertices:d,vertexBytes:0};const D=[I.buffer];if(h){let V=l.scale(l.create(),u,.5),w=l.negate(l.create(),V);const E=Bn(d,g,m,z,v,w,V);A.quantizedData=E.compressedData,A.positionMin=l.clone(w),A.positionMax=l.clone(V),A.vertexBytes=16,D.push(A.quantizedData.buffer)}else A.positions=g,A.normals=m,A.tangents=z,A.uvs=v,A.vertexBytes=3*4+3*4+4*4+2*4,D.push(g.buffer,m.buffer,z.buffer,v.buffer);const q=(performance.now()-t).toFixed(2);console.log(`Face generation time: ${q} milliseconds`),self.postMessage({faceIndex:M,...A},{transfer:D})};
//# sourceMappingURL=boxFaceWorker-Cvil6kZp.js.map
