var Y=1e-6,q=typeof Float32Array<"u"?Float32Array:Array,W=Math.random;Math.hypot||(Math.hypot=function(){for(var n=0,r=arguments.length;r--;)n+=arguments[r]*arguments[r];return Math.sqrt(n)});function sn(){var n=new q(9);return q!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[5]=0,n[6]=0,n[7]=0),n[0]=1,n[4]=1,n[8]=1,n}function fn(){var n=new q(16);return q!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=0,n[12]=0,n[13]=0,n[14]=0),n[0]=1,n[5]=1,n[10]=1,n[15]=1,n}function x(){var n=new q(3);return q!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n}function R(n){var r=new q(3);return r[0]=n[0],r[1]=n[1],r[2]=n[2],r}function N(n){var r=n[0],t=n[1],e=n[2];return Math.hypot(r,t,e)}function z(n,r,t){var e=new q(3);return e[0]=n,e[1]=r,e[2]=t,e}function L(n,r){return n[0]=r[0],n[1]=r[1],n[2]=r[2],n}function on(n,r,t,e){return n[0]=r,n[1]=t,n[2]=e,n}function vn(n,r,t){return n[0]=r[0]+t[0],n[1]=r[1]+t[1],n[2]=r[2]+t[2],n}function O(n,r,t){return n[0]=r[0]-t[0],n[1]=r[1]-t[1],n[2]=r[2]-t[2],n}function _(n,r,t){return n[0]=r[0]*t[0],n[1]=r[1]*t[1],n[2]=r[2]*t[2],n}function k(n,r,t){return n[0]=r[0]/t[0],n[1]=r[1]/t[1],n[2]=r[2]/t[2],n}function Mn(n,r){return n[0]=Math.ceil(r[0]),n[1]=Math.ceil(r[1]),n[2]=Math.ceil(r[2]),n}function ln(n,r){return n[0]=Math.floor(r[0]),n[1]=Math.floor(r[1]),n[2]=Math.floor(r[2]),n}function b(n,r,t){return n[0]=Math.min(r[0],t[0]),n[1]=Math.min(r[1],t[1]),n[2]=Math.min(r[2],t[2]),n}function j(n,r,t){return n[0]=Math.max(r[0],t[0]),n[1]=Math.max(r[1],t[1]),n[2]=Math.max(r[2],t[2]),n}function hn(n,r){return n[0]=Math.round(r[0]),n[1]=Math.round(r[1]),n[2]=Math.round(r[2]),n}function G(n,r,t){return n[0]=r[0]*t,n[1]=r[1]*t,n[2]=r[2]*t,n}function B(n,r,t,e){return n[0]=r[0]+t[0]*e,n[1]=r[1]+t[1]*e,n[2]=r[2]+t[2]*e,n}function nn(n,r){var t=r[0]-n[0],e=r[1]-n[1],a=r[2]-n[2];return Math.hypot(t,e,a)}function rn(n,r){var t=r[0]-n[0],e=r[1]-n[1],a=r[2]-n[2];return t*t+e*e+a*a}function tn(n){var r=n[0],t=n[1],e=n[2];return r*r+t*t+e*e}function S(n,r){return n[0]=-r[0],n[1]=-r[1],n[2]=-r[2],n}function un(n,r){return n[0]=1/r[0],n[1]=1/r[1],n[2]=1/r[2],n}function U(n,r){var t=r[0],e=r[1],a=r[2],c=t*t+e*e+a*a;return c>0&&(c=1/Math.sqrt(c)),n[0]=r[0]*c,n[1]=r[1]*c,n[2]=r[2]*c,n}function E(n,r){return n[0]*r[0]+n[1]*r[1]+n[2]*r[2]}function D(n,r,t){var e=r[0],a=r[1],c=r[2],i=t[0],s=t[1],f=t[2];return n[0]=a*f-c*s,n[1]=c*i-e*f,n[2]=e*s-a*i,n}function yn(n,r,t,e){var a=r[0],c=r[1],i=r[2];return n[0]=a+e*(t[0]-a),n[1]=c+e*(t[1]-c),n[2]=i+e*(t[2]-i),n}function dn(n,r,t,e,a,c){var i=c*c,s=i*(2*c-3)+1,f=i*(c-2)+c,v=i*(c-1),l=i*(3-2*c);return n[0]=r[0]*s+t[0]*f+e[0]*v+a[0]*l,n[1]=r[1]*s+t[1]*f+e[1]*v+a[1]*l,n[2]=r[2]*s+t[2]*f+e[2]*v+a[2]*l,n}function xn(n,r,t,e,a,c){var i=1-c,s=i*i,f=c*c,v=s*i,l=3*c*s,o=3*f*i,M=f*c;return n[0]=r[0]*v+t[0]*l+e[0]*o+a[0]*M,n[1]=r[1]*v+t[1]*l+e[1]*o+a[1]*M,n[2]=r[2]*v+t[2]*l+e[2]*o+a[2]*M,n}function gn(n,r){r=r||1;var t=W()*2*Math.PI,e=W()*2-1,a=Math.sqrt(1-e*e)*r;return n[0]=Math.cos(t)*a,n[1]=Math.sin(t)*a,n[2]=e*r,n}function mn(n,r,t){var e=r[0],a=r[1],c=r[2],i=t[3]*e+t[7]*a+t[11]*c+t[15];return i=i||1,n[0]=(t[0]*e+t[4]*a+t[8]*c+t[12])/i,n[1]=(t[1]*e+t[5]*a+t[9]*c+t[13])/i,n[2]=(t[2]*e+t[6]*a+t[10]*c+t[14])/i,n}function zn(n,r,t){var e=r[0],a=r[1],c=r[2];return n[0]=e*t[0]+a*t[3]+c*t[6],n[1]=e*t[1]+a*t[4]+c*t[7],n[2]=e*t[2]+a*t[5]+c*t[8],n}function An(n,r,t){var e=t[0],a=t[1],c=t[2],i=t[3],s=r[0],f=r[1],v=r[2],l=a*v-c*f,o=c*s-e*v,M=e*f-a*s,y=a*M-c*o,I=c*l-e*M,h=e*o-a*l,u=i*2;return l*=u,o*=u,M*=u,y*=2,I*=2,h*=2,n[0]=s+l+y,n[1]=f+o+I,n[2]=v+M+h,n}function In(n,r,t,e){var a=[],c=[];return a[0]=r[0]-t[0],a[1]=r[1]-t[1],a[2]=r[2]-t[2],c[0]=a[0],c[1]=a[1]*Math.cos(e)-a[2]*Math.sin(e),c[2]=a[1]*Math.sin(e)+a[2]*Math.cos(e),n[0]=c[0]+t[0],n[1]=c[1]+t[1],n[2]=c[2]+t[2],n}function wn(n,r,t,e){var a=[],c=[];return a[0]=r[0]-t[0],a[1]=r[1]-t[1],a[2]=r[2]-t[2],c[0]=a[2]*Math.sin(e)+a[0]*Math.cos(e),c[1]=a[1],c[2]=a[2]*Math.cos(e)-a[0]*Math.sin(e),n[0]=c[0]+t[0],n[1]=c[1]+t[1],n[2]=c[2]+t[2],n}function Tn(n,r,t,e){var a=[],c=[];return a[0]=r[0]-t[0],a[1]=r[1]-t[1],a[2]=r[2]-t[2],c[0]=a[0]*Math.cos(e)-a[1]*Math.sin(e),c[1]=a[0]*Math.sin(e)+a[1]*Math.cos(e),c[2]=a[2],n[0]=c[0]+t[0],n[1]=c[1]+t[1],n[2]=c[2]+t[2],n}function Fn(n,r){var t=n[0],e=n[1],a=n[2],c=r[0],i=r[1],s=r[2],f=Math.sqrt(t*t+e*e+a*a),v=Math.sqrt(c*c+i*i+s*s),l=f*v,o=l&&E(n,r)/l;return Math.acos(Math.min(Math.max(o,-1),1))}function Pn(n){return n[0]=0,n[1]=0,n[2]=0,n}function Vn(n){return"vec3("+n[0]+", "+n[1]+", "+n[2]+")"}function pn(n,r){return n[0]===r[0]&&n[1]===r[1]&&n[2]===r[2]}function qn(n,r){var t=n[0],e=n[1],a=n[2],c=r[0],i=r[1],s=r[2];return Math.abs(t-c)<=Y*Math.max(1,Math.abs(t),Math.abs(c))&&Math.abs(e-i)<=Y*Math.max(1,Math.abs(e),Math.abs(i))&&Math.abs(a-s)<=Y*Math.max(1,Math.abs(a),Math.abs(s))}var J=O,$n=_,Dn=k,Qn=nn,Bn=rn,en=N,Un=tn,En=function(){var n=x();return function(r,t,e,a,c,i){var s,f;for(t||(t=3),e||(e=0),a?f=Math.min(a*t+e,r.length):f=r.length,s=e;s<f;s+=t)n[0]=r[s],n[1]=r[s+1],n[2]=r[s+2],c(n,n,i),r[s]=n[0],r[s+1]=n[1],r[s+2]=n[2];return r}}(),Ln=Object.freeze({__proto__:null,add:vn,angle:Fn,bezier:xn,ceil:Mn,clone:R,copy:L,create:x,cross:D,dist:Qn,distance:nn,div:Dn,divide:k,dot:E,equals:qn,exactEquals:pn,floor:ln,forEach:En,fromValues:z,hermite:dn,inverse:un,len:en,length:N,lerp:yn,max:j,min:b,mul:$n,multiply:_,negate:S,normalize:U,random:gn,rotateX:In,rotateY:wn,rotateZ:Tn,round:hn,scale:G,scaleAndAdd:B,set:on,sqrDist:Bn,sqrLen:Un,squaredDistance:rn,squaredLength:tn,str:Vn,sub:J,subtract:O,transformMat3:zn,transformMat4:mn,transformQuat:An,zero:Pn});function _n(){var n=new q(4);return q!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0,n[3]=0),n}function Rn(n,r,t,e){var a=new q(4);return a[0]=n,a[1]=r,a[2]=t,a[3]=e,a}function Yn(n,r,t){return n[0]=r[0]*t,n[1]=r[1]*t,n[2]=r[2]*t,n[3]=r[3]*t,n}function Cn(n,r){var t=r[0],e=r[1],a=r[2],c=r[3],i=t*t+e*e+a*a+c*c;return i>0&&(i=1/Math.sqrt(i)),n[0]=t*i,n[1]=e*i,n[2]=a*i,n[3]=c*i,n}(function(){var n=_n();return function(r,t,e,a,c,i){var s,f;for(t||(t=4),e||(e=0),a?f=Math.min(a*t+e,r.length):f=r.length,s=e;s<f;s+=t)n[0]=r[s],n[1]=r[s+1],n[2]=r[s+2],n[3]=r[s+3],c(n,n,i),r[s]=n[0],r[s+1]=n[1],r[s+2]=n[2],r[s+3]=n[3];return r}})();function Z(){var n=new q(4);return q!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n[3]=1,n}function Nn(n,r,t){t=t*.5;var e=Math.sin(t);return n[0]=e*r[0],n[1]=e*r[1],n[2]=e*r[2],n[3]=Math.cos(t),n}function H(n,r,t,e){var a=r[0],c=r[1],i=r[2],s=r[3],f=t[0],v=t[1],l=t[2],o=t[3],M,y,I,h,u;return y=a*f+c*v+i*l+s*o,y<0&&(y=-y,f=-f,v=-v,l=-l,o=-o),1-y>Y?(M=Math.acos(y),I=Math.sin(M),h=Math.sin((1-e)*M)/I,u=Math.sin(e*M)/I):(h=1-e,u=e),n[0]=h*a+u*f,n[1]=h*c+u*v,n[2]=h*i+u*l,n[3]=h*s+u*o,n}function an(n,r){var t=r[0]+r[4]+r[8],e;if(t>0)e=Math.sqrt(t+1),n[3]=.5*e,e=.5/e,n[0]=(r[5]-r[7])*e,n[1]=(r[6]-r[2])*e,n[2]=(r[1]-r[3])*e;else{var a=0;r[4]>r[0]&&(a=1),r[8]>r[a*3+a]&&(a=2);var c=(a+1)%3,i=(a+2)%3;e=Math.sqrt(r[a*3+a]-r[c*3+c]-r[i*3+i]+1),n[a]=.5*e,e=.5/e,n[3]=(r[c*3+i]-r[i*3+c])*e,n[c]=(r[c*3+a]+r[a*3+c])*e,n[i]=(r[i*3+a]+r[a*3+i])*e}return n}var cn=Yn,K=Cn;(function(){var n=x(),r=z(1,0,0),t=z(0,1,0);return function(e,a,c){var i=E(a,c);return i<-.999999?(D(n,r,a),en(n)<1e-6&&D(n,t,a),U(n,n),Nn(e,n,Math.PI),e):i>.999999?(e[0]=0,e[1]=0,e[2]=0,e[3]=1,e):(D(n,a,c),e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=1+i,K(e,e))}})();(function(){var n=Z(),r=Z();return function(t,e,a,c,i,s){return H(n,e,i,s),H(r,a,c,s),H(t,n,r,2*s*(1-s)),t}})();(function(){var n=sn();return function(r,t,e,a){return n[0]=e[0],n[3]=e[1],n[6]=e[2],n[1]=a[0],n[4]=a[1],n[7]=a[2],n[2]=-t[0],n[5]=-t[1],n[8]=-t[2],K(r,an(r,n))}})();function On(n,r,t){const e=R(n),a=R(r);U(e,e),U(a,a);const c=Math.abs(e[0])<.9?z(1,0,0):z(0,1,0),i=D(x(),e,c);U(i,i);const s=E(a,i),f=D(x(),i,a),v=E(f,e),o=(Math.atan2(v,s)+Math.PI)/(2*Math.PI),M=Math.round(o*32767)&32767;return(t>0?1:0)<<15|M}const Xn=8;var C=(n=>(n.Uncompressed="none",n.Angle16Bits="angle16bits",n.Quaternion12Bits="quaternion12bits",n))(C||{});function Hn(n,r,t,e,a,c,i){const s=new Uint16Array(n*8),f=z(1/0,1/0,1/0),v=z(-1/0,-1/0,-1/0);if(!c||!i)for(let o=0;o<r.length;o+=3)f[0]=Math.min(f[0],r[o]),f[1]=Math.min(f[1],r[o+1]),f[2]=Math.min(f[2],r[o+2]),v[0]=Math.max(v[0],r[o]),v[1]=Math.max(v[1],r[o+1]),v[2]=Math.max(v[2],r[o+2]);else L(f,c),L(v,i);const l=J(x(),v,f);for(let o=0;o<n;o++){const M=o*3,y=o*4,I=o*2,h=o*8,u=(r[M]-f[0])/l[0],g=(r[M+1]-f[1])/l[1],m=(r[M+2]-f[2])/l[2];s[h]=u*65535,s[h+1]=g*65535,s[h+2]=m*65535;const w=z(t[M],t[M+1],t[M+2]),d=z(e[y],e[y+1],e[y+2]),T=e[y+3]>0?1:0,A=On(w,d,T);s[h+3]=A;const V=t[M],$=t[M+1],F=t[M+2],P=1/(Math.abs(V)+Math.abs($)+Math.abs(F));let p=V*P,Q=$*P;if(F<0){const X=p;p=(1-Math.abs(Q))*(p>=0?1:-1),Q=(1-Math.abs(X))*(Q>=0?1:-1)}s[h+4]=(p*.5+.5)*65535|0,s[h+5]=(Q*.5+.5)*65535|0,s[h+6]=a[I]*65535|0,s[h+7]=a[I+1]*65535|0}return{compressedData:s,positionMin:f,positionMax:v}}function Zn(n,r,t,e,a,c,i){const s=new Uint16Array(n*8),f=z(1/0,1/0,1/0),v=z(-1/0,-1/0,-1/0);if(!c||!i)for(let o=0;o<r.length;o+=3)f[0]=Math.min(f[0],r[o]),f[1]=Math.min(f[1],r[o+1]),f[2]=Math.min(f[2],r[o+2]),v[0]=Math.max(v[0],r[o]),v[1]=Math.max(v[1],r[o+1]),v[2]=Math.max(v[2],r[o+2]);else L(f,c),L(v,i);const l=J(x(),v,f);for(let o=0;o<n;o++){const M=o*3,y=o*4,I=o*2,h=o*8,u=(r[M]-f[0])/l[0],g=(r[M+1]-f[1])/l[1],m=(r[M+2]-f[2])/l[2];s[h]=u*65535,s[h+1]=g*65535,s[h+2]=m*65535;const w=z(t[M],t[M+1],t[M+2]),d=z(e[y],e[y+1],e[y+2]),T=e[y+3]>0?1:0,A=Wn(Z(),w,Rn(d[0],d[1],d[2],T),Kn),V=[Math.round((A[0]*.5+.5)*4095),Math.round((A[1]*.5+.5)*4095),Math.round((A[2]*.5+.5)*4095),Math.round((A[3]*.5+.5)*4095)],[$,F,P]=Gn(V[0],V[1],V[2],V[3]);s[h+3]=$,s[h+4]=F,s[h+5]=P,s[h+6]=a[I]*65535|0,s[h+7]=a[I+1]*65535|0}return{compressedData:s,positionMin:f,positionMax:v}}function Gn(n,r,t,e){const a=n&4095|(r&15)<<12,c=r>>4&255|(t&255)<<8,i=t>>8&15|(e&4095)<<4;return[a,c,i]}function Sn(n,r,t,e,a,c,i,s,f,v){return n[0]=r,n[1]=t,n[2]=e,n[3]=a,n[4]=c,n[5]=i,n[6]=s,n[7]=f,n[8]=v,n}function Jn(n){return n[3]<0?cn(n,n,-1):n}const Kn={TMP0:x(),TMP1:x(),TMP2:x(),MAT0:fn(),F0:z(0,0,1),F1:z(2,-2,-2),F2:z(2,2,-2),Q0:z(1,0,0),Q1:z(-2,2,-2),Q2:z(-2,2,2)};function Wn(n,r,t,e){const a=D(e.TMP0,r,t),c=Sn(e.MAT0,t[0],t[1],t[2],a[0],a[1],a[2],r[0],r[1],r[2]);n=an(n,c),n=K(n,n),n=Jn(n);const s=1/((1<<2*Xn-1)-1);if(n[3]<s){n[3]=s;const l=Math.sqrt(1-s*s);n[0]*=l,n[1]*=l,n[2]*=l}const f=t[3]>0?D(e.TMP1,t,r):D(e.TMP1,r,t),v=D(e.TMP2,t,r);return E(v,f)<0&&cn(n,n,-1),n}function kn(n,r,t,e,a,c,i,s,f,v,l){const o=v*l;let M=x(),y=x(),I=x(),h=x();for(let u=0;u<c;u++)for(let g=0;g<i;g++){B(M,n,r,e*u/c),B(M,M,t,a*g/i),B(y,M,r,e/c),B(I,y,t,a/i),B(h,M,t,a/i);const m=u*i+g,w=m*4,d=w*3;f[d+0]=M[0],f[d+1]=M[1],f[d+2]=M[2],f[d+3]=y[0],f[d+4]=y[1],f[d+5]=y[2],f[d+6]=I[0],f[d+7]=I[1],f[d+8]=I[2],f[d+9]=h[0],f[d+10]=h[1],f[d+11]=h[2];const T=m*6;s[T+0]=o+w+0,s[T+1]=o+w+2,s[T+2]=o+w+1,s[T+3]=o+w+0,s[T+4]=o+w+3,s[T+5]=o+w+2}}function bn(n,r,t,e,a,c,i,s,f,v,l,o,M){const y=i.length/3,I=N(_(x(),r,e)),h=N(_(x(),t,e));n=_(x(),n,e),kn(n,r,t,I,h,c,c,l,i,M,y);{const u=x(),g=x(),m=x(),w=x(),d=x(),T=G(x(),e,.5),A=O(x(),T,[a,a,a]),V=S(x(),A);for(let $=0;$<y;$++){const F=$*3,P=$*2,p=$*4;u[0]=i[F],u[1]=i[F+1],u[2]=i[F+2],j(d,V,u),b(d,A,d),O(g,u,d),U(g,g),B(u,d,g,a),i[F]=u[0],i[F+1]=u[1],i[F+2]=u[2],v[P]=u[o[0]]/e[o[0]]+.5,v[P+1]=u[o[1]]/e[o[1]]+.5,s[F]=g[0],s[F+1]=g[1],s[F+2]=g[2],L(m,r),U(m,m);const Q=E(m,g);B(m,m,g,-Q),U(m,m),D(w,g,m);const X=E(w,t)>0?1:-1;f[p]=m[0],f[p+1]=m[1],f[p+2]=m[2],f[p+3]=X}}}self.onmessage=async n=>{for(;!Ln;)await new Promise(P=>setTimeout(P,10));const r=performance.now(),{start:t,right:e,up:a,uvIndex:c,size:i,radius:s,resolution:f,faceIndex:v,numVerticesPerFace:l,numIndicesPerFace:o,quantizationFormat:M}=n.data,y=z(t[0],t[1],t[2]),I=z(e[0],e[1],e[2]),h=z(a[0],a[1],a[2]),u=z(i[0],i[1],i[2]),g=new Float32Array(l*3),m=new Float32Array(l*3),w=new Float32Array(l*4),d=new Float32Array(l*2),T=new Uint32Array(o);bn(y,I,h,u,s,f,g,m,w,d,T,c,v);let A={indices:T,numVertices:l,vertexBytes:0};const V=[T.buffer];if(M!==C.Uncompressed){let P=G(x(),u,.5),p=S(x(),P),Q;switch(M){case C.Quaternion12Bits:Q=Zn(l,g,m,w,d,p,P),A.vertexBytes=16;break;case C.Angle16Bits:default:Q=Hn(l,g,m,w,d,p,P),A.vertexBytes=16;break}A.quantizedData=Q.compressedData,A.positionMin=R(p),A.positionMax=R(P),V.push(A.quantizedData.buffer)}else A.positions=g,A.normals=m,A.tangents=w,A.uvs=d,A.vertexBytes=3*4+3*4+4*4+2*4,V.push(g.buffer,m.buffer,w.buffer,d.buffer);const F=(performance.now()-r).toFixed(2);console.log(`Face generation time: ${F} milliseconds`),self.postMessage({faceIndex:v,...A},{transfer:V})};
//# sourceMappingURL=boxFaceWorker-DkkYw5bk.js.map
