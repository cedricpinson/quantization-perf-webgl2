var O=1e-6,x=typeof Float32Array<"u"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var n=0,t=arguments.length;t--;)n+=arguments[t]*arguments[t];return Math.sqrt(n)});function X(){var n=new x(9);return x!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[5]=0,n[6]=0,n[7]=0),n[0]=1,n[4]=1,n[8]=1,n}function k(){var n=new x(16);return x!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=0,n[12]=0,n[13]=0,n[14]=0),n[0]=1,n[5]=1,n[10]=1,n[15]=1,n}function z(){var n=new x(3);return x!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n}function E(n){var t=new x(3);return t[0]=n[0],t[1]=n[1],t[2]=n[2],t}function G(n){var t=n[0],e=n[1],r=n[2];return Math.hypot(t,e,r)}function g(n,t,e){var r=new x(3);return r[0]=n,r[1]=t,r[2]=e,r}function J(n,t,e){return n[0]=t[0]-e[0],n[1]=t[1]-e[1],n[2]=t[2]-e[2],n}function D(n,t){var e=t[0],r=t[1],a=t[2],s=e*e+r*r+a*a;return s>0&&(s=1/Math.sqrt(s)),n[0]=t[0]*s,n[1]=t[1]*s,n[2]=t[2]*s,n}function V(n,t){return n[0]*t[0]+n[1]*t[1]+n[2]*t[2]}function p(n,t,e){var r=t[0],a=t[1],s=t[2],i=e[0],c=e[1],o=e[2];return n[0]=a*o-s*c,n[1]=s*i-r*o,n[2]=r*c-a*i,n}var L=J,K=G;(function(){var n=z();return function(t,e,r,a,s,i){var c,o;for(e||(e=3),r||(r=0),a?o=Math.min(a*e+r,t.length):o=t.length,c=r;c<o;c+=e)n[0]=t[c],n[1]=t[c+1],n[2]=t[c+2],s(n,n,i),t[c]=n[0],t[c+1]=n[1],t[c+2]=n[2];return t}})();function W(){var n=new x(4);return x!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0,n[3]=0),n}function Z(n,t,e,r){var a=new x(4);return a[0]=n,a[1]=t,a[2]=e,a[3]=r,a}function q(n,t,e){return n[0]=t[0]*e,n[1]=t[1]*e,n[2]=t[2]*e,n[3]=t[3]*e,n}function j(n,t){var e=t[0],r=t[1],a=t[2],s=t[3],i=e*e+r*r+a*a+s*s;return i>0&&(i=1/Math.sqrt(i)),n[0]=e*i,n[1]=r*i,n[2]=a*i,n[3]=s*i,n}(function(){var n=W();return function(t,e,r,a,s,i){var c,o;for(e||(e=4),r||(r=0),a?o=Math.min(a*e+r,t.length):o=t.length,c=r;c<o;c+=e)n[0]=t[c],n[1]=t[c+1],n[2]=t[c+2],n[3]=t[c+3],s(n,n,i),t[c]=n[0],t[c+1]=n[1],t[c+2]=n[2],t[c+3]=n[3];return t}})();function C(){var n=new x(4);return x!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n[3]=1,n}function nn(n,t,e){e=e*.5;var r=Math.sin(e);return n[0]=r*t[0],n[1]=r*t[1],n[2]=r*t[2],n[3]=Math.cos(e),n}function R(n,t,e,r){var a=t[0],s=t[1],i=t[2],c=t[3],o=e[0],h=e[1],l=e[2],f=e[3],u,y,v,M,d;return y=a*o+s*h+i*l+c*f,y<0&&(y=-y,o=-o,h=-h,l=-l,f=-f),1-y>O?(u=Math.acos(y),v=Math.sin(u),M=Math.sin((1-r)*u)/v,d=Math.sin(r*u)/v):(M=1-r,d=r),n[0]=M*a+d*o,n[1]=M*s+d*h,n[2]=M*i+d*l,n[3]=M*c+d*f,n}function N(n,t){var e=t[0]+t[4]+t[8],r;if(e>0)r=Math.sqrt(e+1),n[3]=.5*r,r=.5/r,n[0]=(t[5]-t[7])*r,n[1]=(t[6]-t[2])*r,n[2]=(t[1]-t[3])*r;else{var a=0;t[4]>t[0]&&(a=1),t[8]>t[a*3+a]&&(a=2);var s=(a+1)%3,i=(a+2)%3;r=Math.sqrt(t[a*3+a]-t[s*3+s]-t[i*3+i]+1),n[a]=.5*r,r=.5/r,n[3]=(t[s*3+i]-t[i*3+s])*r,n[s]=(t[s*3+a]+t[a*3+s])*r,n[i]=(t[i*3+a]+t[a*3+i])*r}return n}var _=q,Y=j;(function(){var n=z(),t=g(1,0,0),e=g(0,1,0);return function(r,a,s){var i=V(a,s);return i<-.999999?(p(n,t,a),K(n)<1e-6&&p(n,e,a),D(n,n),nn(r,n,Math.PI),r):i>.999999?(r[0]=0,r[1]=0,r[2]=0,r[3]=1,r):(p(n,a,s),r[0]=n[0],r[1]=n[1],r[2]=n[2],r[3]=1+i,Y(r,r))}})();(function(){var n=C(),t=C();return function(e,r,a,s,i,c){return R(n,r,i,c),R(t,a,s,c),R(e,n,t,2*c*(1-c)),e}})();(function(){var n=X();return function(t,e,r,a){return n[0]=r[0],n[3]=r[1],n[6]=r[2],n[1]=a[0],n[4]=a[1],n[7]=a[2],n[2]=-e[0],n[5]=-e[1],n[8]=-e[2],Y(t,N(t,n))}})();function tn(n,t,e){const r=E(n),a=E(t);D(r,r),D(a,a);const s=Math.abs(r[0])<.9?g(1,0,0):g(0,1,0),i=p(z(),r,s);D(i,i);const c=V(a,i),o=p(z(),i,a),h=V(o,r),f=(Math.atan2(h,c)+Math.PI)/(2*Math.PI),u=Math.round(f*32767)&32767;return(e>0?1:0)<<15|u}const rn=8;var Q=(n=>(n.Uncompressed="none",n.Angle16Bits="angle16bits",n.Quaternion12Bits="quaternion12bits",n))(Q||{});function en(n,t,e,r,a,s,i){const c=new Uint16Array(n*8),o=g(1/0,1/0,1/0),h=g(-1/0,-1/0,-1/0);for(let f=0;f<t.length;f+=3)o[0]=Math.min(o[0],t[f]),o[1]=Math.min(o[1],t[f+1]),o[2]=Math.min(o[2],t[f+2]),h[0]=Math.max(h[0],t[f]),h[1]=Math.max(h[1],t[f+1]),h[2]=Math.max(h[2],t[f+2]);const l=L(z(),h,o);for(let f=0;f<n;f++){const u=f*3,y=f*4,v=f*2,M=f*8,d=(t[u]-o[0])/l[0],m=(t[u+1]-o[1])/l[1],w=(t[u+2]-o[2])/l[2];c[M]=d*65535,c[M+1]=m*65535,c[M+2]=w*65535;const B=g(e[u],e[u+1],e[u+2]),U=g(r[y],r[y+1],r[y+2]),S=r[y+3]>0?1:0,A=tn(B,U,S);c[M+3]=A;const I=e[u],P=e[u+1],T=e[u+2],b=1/(Math.abs(I)+Math.abs(P)+Math.abs(T));let F=I*b,$=P*b;if(T<0){const H=F;F=(1-Math.abs($))*(F>=0?1:-1),$=(1-Math.abs(H))*($>=0?1:-1)}c[M+4]=(F*.5+.5)*65535|0,c[M+5]=($*.5+.5)*65535|0,c[M+6]=a[v]*65535|0,c[M+7]=a[v+1]*65535|0}return{compressedData:c,positionMin:o,positionMax:h}}function an(n,t,e,r,a,s,i){const c=new Uint16Array(n*8),o=g(1/0,1/0,1/0),h=g(-1/0,-1/0,-1/0);for(let f=0;f<t.length;f+=3)o[0]=Math.min(o[0],t[f]),o[1]=Math.min(o[1],t[f+1]),o[2]=Math.min(o[2],t[f+2]),h[0]=Math.max(h[0],t[f]),h[1]=Math.max(h[1],t[f+1]),h[2]=Math.max(h[2],t[f+2]);const l=L(z(),h,o);for(let f=0;f<n;f++){const u=f*3,y=f*4,v=f*2,M=f*8,d=(t[u]-o[0])/l[0],m=(t[u+1]-o[1])/l[1],w=(t[u+2]-o[2])/l[2];c[M]=d*65535,c[M+1]=m*65535,c[M+2]=w*65535;const B=g(e[u],e[u+1],e[u+2]),U=g(r[y],r[y+1],r[y+2]),S=r[y+3]>0?1:0,A=ln(C(),B,Z(U[0],U[1],U[2],S),fn),I=[Math.round((A[0]*.5+.5)*4095),Math.round((A[1]*.5+.5)*4095),Math.round((A[2]*.5+.5)*4095),Math.round((A[3]*.5+.5)*4095)],[P,T,b]=cn(I[0],I[1],I[2],I[3]);c[M+3]=P,c[M+4]=T,c[M+5]=b,c[M+6]=a[v]*65535|0,c[M+7]=a[v+1]*65535|0}return{compressedData:c,positionMin:o,positionMax:h}}function cn(n,t,e,r){const a=n&4095|(t&15)<<12,s=t>>4&255|(e&255)<<8,i=e>>8&15|(r&4095)<<4;return[a,s,i]}function on(n,t,e,r,a,s,i,c,o,h){return n[0]=t,n[1]=e,n[2]=r,n[3]=a,n[4]=s,n[5]=i,n[6]=c,n[7]=o,n[8]=h,n}function sn(n){return n[3]<0?_(n,n,-1):n}const fn={TMP0:z(),TMP1:z(),TMP2:z(),MAT0:k(),F0:g(0,0,1),F1:g(2,-2,-2),F2:g(2,2,-2),Q0:g(1,0,0),Q1:g(-2,2,-2),Q2:g(-2,2,2)};function ln(n,t,e,r){const a=p(r.TMP0,t,e),s=on(r.MAT0,e[0],e[1],e[2],a[0],a[1],a[2],t[0],t[1],t[2]);n=N(n,s),n=Y(n,n),n=sn(n);const c=1/((1<<2*rn-1)-1);if(n[3]<c){n[3]=c;const l=Math.sqrt(1-c*c);n[0]*=l,n[1]*=l,n[2]*=l}const o=e[3]>0?p(r.TMP1,e,t):p(r.TMP1,t,e),h=p(r.TMP2,e,t);return V(h,o)<0&&_(n,n,-1),n}self.onmessage=async n=>{const t=performance.now(),{resolution:e,quantizationFormat:r}=n.data,a=(e+1)*(e+1),s=new Float32Array(a*3),i=new Float32Array(a*3),c=new Float32Array(a*4),o=new Float32Array(a*2),h=new Uint32Array(e*e*6);let l=0;for(let v=0;v<=e;v++){const M=v*Math.PI/e,d=Math.sin(M),m=Math.cos(M);for(let w=0;w<=e;w++){const B=w*2*Math.PI/e,U=Math.sin(B),A=Math.cos(B)*d,I=m,P=U*d;s[l*3]=A,s[l*3+1]=I,s[l*3+2]=P,i[l*3]=A,i[l*3+1]=I,i[l*3+2]=P;const T=-P,b=0,F=A,$=Math.sqrt(T*T+b*b+F*F);c[l*4]=T/$,c[l*4+1]=b/$,c[l*4+2]=F/$,c[l*4+3]=1,o[l*2]=w/e,o[l*2+1]=v/e,l++}}l=0;for(let v=0;v<e;v++)for(let M=0;M<e;M++){const d=v*(e+1)+M,m=d+e+1;h[l]=d,h[l+1]=m,h[l+2]=d+1,h[l+3]=m,h[l+4]=m+1,h[l+5]=d+1,l+=6}const f={indices:h,vertexBytes:r===Q.Uncompressed?3*4+3*4+4*4+2*4:16,numVertices:a};if(r!==Q.Uncompressed){let v;switch(r){case Q.Quaternion12Bits:v=an(a,s,i,c,o),f.vertexBytes=16;break;case Q.Angle16Bits:default:v=en(a,s,i,c,o),f.vertexBytes=16;break}f.quantizedData=v.compressedData,f.positionMin=v.positionMin,f.positionMax=v.positionMax}else f.positions=s,f.normals=i,f.tangents=c,f.uvs=o;const y=performance.now()-t;console.log(`Sphere generation took ${y.toFixed(2)}ms`),self.postMessage(f,{transfer:[...r===Q.Uncompressed?[s.buffer,i.buffer,c.buffer,o.buffer]:[f.quantizedData.buffer],h.buffer]})};
//# sourceMappingURL=sphereWorker-CDeKLj9m.js.map
