var G=1e-6,A=typeof Float32Array<"u"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var n=0,t=arguments.length;t--;)n+=arguments[t]*arguments[t];return Math.sqrt(n)});function H(){var n=new A(9);return A!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[5]=0,n[6]=0,n[7]=0),n[0]=1,n[4]=1,n[8]=1,n}function J(){var n=new A(16);return A!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=0,n[12]=0,n[13]=0,n[14]=0),n[0]=1,n[5]=1,n[10]=1,n[15]=1,n}function T(){var n=new A(3);return A!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n}function E(n){var t=new A(3);return t[0]=n[0],t[1]=n[1],t[2]=n[2],t}function K(n){var t=n[0],e=n[1],r=n[2];return Math.hypot(t,e,r)}function x(n,t,e){var r=new A(3);return r[0]=n,r[1]=t,r[2]=e,r}function W(n,t,e){return n[0]=t[0]-e[0],n[1]=t[1]-e[1],n[2]=t[2]-e[2],n}function S(n,t){var e=t[0],r=t[1],a=t[2],s=e*e+r*r+a*a;return s>0&&(s=1/Math.sqrt(s)),n[0]=t[0]*s,n[1]=t[1]*s,n[2]=t[2]*s,n}function V(n,t){return n[0]*t[0]+n[1]*t[1]+n[2]*t[2]}function q(n,t,e){var r=t[0],a=t[1],s=t[2],i=e[0],c=e[1],o=e[2];return n[0]=a*o-s*c,n[1]=s*i-r*o,n[2]=r*c-a*i,n}var N=W,Z=K;(function(){var n=T();return function(t,e,r,a,s,i){var c,o;for(e||(e=3),r||(r=0),a?o=Math.min(a*e+r,t.length):o=t.length,c=r;c<o;c+=e)n[0]=t[c],n[1]=t[c+1],n[2]=t[c+2],s(n,n,i),t[c]=n[0],t[c+1]=n[1],t[c+2]=n[2];return t}})();function O(){var n=new A(4);return A!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0,n[3]=0),n}function k(n,t,e,r,a){return n[0]=t,n[1]=e,n[2]=r,n[3]=a,n}function j(n,t,e){return n[0]=t[0]*e,n[1]=t[1]*e,n[2]=t[2]*e,n[3]=t[3]*e,n}function nn(n,t){var e=t[0],r=t[1],a=t[2],s=t[3],i=e*e+r*r+a*a+s*s;return i>0&&(i=1/Math.sqrt(i)),n[0]=e*i,n[1]=r*i,n[2]=a*i,n[3]=s*i,n}(function(){var n=O();return function(t,e,r,a,s,i){var c,o;for(e||(e=4),r||(r=0),a?o=Math.min(a*e+r,t.length):o=t.length,c=r;c<o;c+=e)n[0]=t[c],n[1]=t[c+1],n[2]=t[c+2],n[3]=t[c+3],s(n,n,i),t[c]=n[0],t[c+1]=n[1],t[c+2]=n[2],t[c+3]=n[3];return t}})();function Y(){var n=new A(4);return A!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n[3]=1,n}function tn(n,t,e){e=e*.5;var r=Math.sin(e);return n[0]=r*t[0],n[1]=r*t[1],n[2]=r*t[2],n[3]=Math.cos(e),n}function R(n,t,e,r){var a=t[0],s=t[1],i=t[2],c=t[3],o=e[0],h=e[1],f=e[2],l=e[3],g,M,v,y,u;return M=a*o+s*h+i*f+c*l,M<0&&(M=-M,o=-o,h=-h,f=-f,l=-l),1-M>G?(g=Math.acos(M),v=Math.sin(g),y=Math.sin((1-r)*g)/v,u=Math.sin(r*g)/v):(y=1-r,u=r),n[0]=y*a+u*o,n[1]=y*s+u*h,n[2]=y*i+u*f,n[3]=y*c+u*l,n}function X(n,t){var e=t[0]+t[4]+t[8],r;if(e>0)r=Math.sqrt(e+1),n[3]=.5*r,r=.5/r,n[0]=(t[5]-t[7])*r,n[1]=(t[6]-t[2])*r,n[2]=(t[1]-t[3])*r;else{var a=0;t[4]>t[0]&&(a=1),t[8]>t[a*3+a]&&(a=2);var s=(a+1)%3,i=(a+2)%3;r=Math.sqrt(t[a*3+a]-t[s*3+s]-t[i*3+i]+1),n[a]=.5*r,r=.5/r,n[3]=(t[s*3+i]-t[i*3+s])*r,n[s]=(t[s*3+a]+t[a*3+s])*r,n[i]=(t[i*3+a]+t[a*3+i])*r}return n}var L=j,C=nn;(function(){var n=T(),t=x(1,0,0),e=x(0,1,0);return function(r,a,s){var i=V(a,s);return i<-.999999?(q(n,t,a),Z(n)<1e-6&&q(n,e,a),S(n,n),tn(r,n,Math.PI),r):i>.999999?(r[0]=0,r[1]=0,r[2]=0,r[3]=1,r):(q(n,a,s),r[0]=n[0],r[1]=n[1],r[2]=n[2],r[3]=1+i,C(r,r))}})();(function(){var n=Y(),t=Y();return function(e,r,a,s,i,c){return R(n,r,i,c),R(t,a,s,c),R(e,n,t,2*c*(1-c)),e}})();(function(){var n=H();return function(t,e,r,a){return n[0]=r[0],n[3]=r[1],n[6]=r[2],n[1]=a[0],n[4]=a[1],n[7]=a[2],n[2]=-e[0],n[5]=-e[1],n[8]=-e[2],C(t,X(t,n))}})();function rn(n,t,e){const r=E(n),a=E(t);S(r,r),S(a,a);const s=Math.abs(r[0])<.9?x(1,0,0):x(0,1,0),i=q(T(),r,s);S(i,i);const c=V(a,i),o=q(T(),i,a),h=V(o,r),l=(Math.atan2(h,c)+Math.PI)/(2*Math.PI),g=Math.round(l*32767)&32767;return(e>0?1:0)<<15|g}var U=(n=>(n.Uncompressed="none",n.Angle16Bits="angle16bits",n.Quaternion12Bits="quaternion12bits",n))(U||{});function en(n,t,e,r,a,s,i){const c=new Uint16Array(n*8),o=x(1/0,1/0,1/0),h=x(-1/0,-1/0,-1/0);for(let l=0;l<t.length;l+=3)o[0]=Math.min(o[0],t[l]),o[1]=Math.min(o[1],t[l+1]),o[2]=Math.min(o[2],t[l+2]),h[0]=Math.max(h[0],t[l]),h[1]=Math.max(h[1],t[l+1]),h[2]=Math.max(h[2],t[l+2]);const f=N(T(),h,o);for(let l=0;l<n;l++){const g=l*3,M=l*4,v=l*2,y=l*8,u=(t[g]-o[0])/f[0],d=(t[g+1]-o[1])/f[1],m=(t[g+2]-o[2])/f[2];c[y]=u*65535,c[y+1]=d*65535,c[y+2]=m*65535;const P=x(e[g],e[g+1],e[g+2]),$=x(r[M],r[M+1],r[M+2]),Q=r[M+3]>0?1:0,I=rn(P,$,Q);c[y+3]=I;const w=e[g],F=e[g+1],b=e[g+2],B=1/(Math.abs(w)+Math.abs(F)+Math.abs(b));let z=w*B,p=F*B;if(b<0){const _=z;z=(1-Math.abs(p))*(z>=0?1:-1),p=(1-Math.abs(_))*(p>=0?1:-1)}c[y+4]=(z*.5+.5)*65535|0,c[y+5]=(p*.5+.5)*65535|0,c[y+6]=a[v]*65535|0,c[y+7]=a[v+1]*65535|0}return{compressedData:c,positionMin:o,positionMax:h}}function an(n,t,e,r,a,s,i){const c=new Uint16Array(n*8),o=x(1/0,1/0,1/0),h=x(-1/0,-1/0,-1/0);for(let M=0;M<t.length;M+=3)o[0]=Math.min(o[0],t[M]),o[1]=Math.min(o[1],t[M+1]),o[2]=Math.min(o[2],t[M+2]),h[0]=Math.max(h[0],t[M]),h[1]=Math.max(h[1],t[M+1]),h[2]=Math.max(h[2],t[M+2]);const f=N(T(),h,o),l=new Uint16Array(n*3),g=O();for(let M=0;M<n;M++){const v=M*3,y=M*4,u=M*2,d=M*8,m=(t[v]-o[0])/f[0],P=(t[v+1]-o[1])/f[1],$=(t[v+2]-o[2])/f[2];c[d]=m*65535,c[d+1]=P*65535,c[d+2]=$*65535;const Q=x(e[v],e[v+1],e[v+2]),I=x(r[y],r[y+1],r[y+2]),w=r[y+3]>0?1:0;k(g,I[0],I[1],I[2],w),hn(l,Q,g,fn),c[d+3]=l[0],c[d+4]=l[1],c[d+5]=l[2],c[d+6]=a[u]*65535|0,c[d+7]=a[u+1]*65535|0}return{compressedData:c,positionMin:o,positionMax:h}}function cn(n,t,e,r,a){const s=t&4095|(e&15)<<12,i=e>>4&255|(r&255)<<8,c=r>>8&15|(a&4095)<<4;return n[0]=s,n[1]=i,n[2]=c,n}function D(n,t){const e=(1<<t)-1;return Math.round((n*.5+.5)*e)}function sn(n,t,e,r,a){const s=D(t,12),i=D(e,12),c=D(r,12),o=D(a,12);return cn(n,s,i,c,o)}function on(n,t,e,r,a,s,i,c,o,h){return n[0]=t,n[1]=e,n[2]=r,n[3]=a,n[4]=s,n[5]=i,n[6]=c,n[7]=o,n[8]=h,n}const fn={TMP0:T(),TMP1:T(),TMP2:T(),MAT0:J(),F0:x(0,0,1),F1:x(2,-2,-2),F2:x(2,2,-2),Q0:x(1,0,0),Q1:x(-2,2,-2),Q2:x(-2,2,2),qTangent:Y()};function ln(n,t,e,r,a){const s=q(r.TMP0,t,e),i=on(r.MAT0,e[0],e[1],e[2],s[0],s[1],s[2],t[0],t[1],t[2]);X(n,i),C(n,n),n[3]<0&&L(n,n,-1);const c=1/((1<<a-1)-1);if(n[3]<c){n[3]=c;const f=Math.sqrt(1-c*c);n[0]*=f,n[1]*=f,n[2]*=f}const o=e[3]>0?q(r.TMP1,e,t):q(r.TMP1,t,e),h=q(r.TMP2,e,t);return V(h,o)<0&&L(n,n,-1),n}function hn(n,t,e,r){const a=ln(r.qTangent,t,e,r,12);return sn(n,a[0],a[1],a[2],a[3])}self.onmessage=async n=>{const t=performance.now(),{resolution:e,quantizationFormat:r}=n.data,a=(e+1)*(e+1),s=new Float32Array(a*3),i=new Float32Array(a*3),c=new Float32Array(a*4),o=new Float32Array(a*2),h=new Uint32Array(e*e*6);let f=0;for(let v=0;v<=e;v++){const y=v*Math.PI/e,u=Math.sin(y),d=Math.cos(y);for(let m=0;m<=e;m++){const P=m*2*Math.PI/e,$=Math.sin(P),I=Math.cos(P)*u,w=d,F=$*u;s[f*3]=I,s[f*3+1]=w,s[f*3+2]=F,i[f*3]=I,i[f*3+1]=w,i[f*3+2]=F;const b=-F,B=0,z=I,p=Math.sqrt(b*b+B*B+z*z);c[f*4]=b/p,c[f*4+1]=B/p,c[f*4+2]=z/p,c[f*4+3]=1,o[f*2]=m/e,o[f*2+1]=v/e,f++}}f=0;for(let v=0;v<e;v++)for(let y=0;y<e;y++){const u=v*(e+1)+y,d=u+e+1;h[f]=u,h[f+1]=d,h[f+2]=u+1,h[f+3]=d,h[f+4]=d+1,h[f+5]=u+1,f+=6}const l={indices:h,vertexBytes:r===U.Uncompressed?3*4+3*4+4*4+2*4:16,numVertices:a};if(r!==U.Uncompressed){let v;switch(r){case U.Quaternion12Bits:v=an(a,s,i,c,o),l.vertexBytes=16;break;case U.Angle16Bits:default:v=en(a,s,i,c,o),l.vertexBytes=16;break}l.quantizedData=v.compressedData,l.positionMin=v.positionMin,l.positionMax=v.positionMax}else l.positions=s,l.normals=i,l.tangents=c,l.uvs=o;const M=performance.now()-t;console.log(`Sphere generation took ${M.toFixed(2)}ms`),self.postMessage(l,{transfer:[...r===U.Uncompressed?[s.buffer,i.buffer,c.buffer,o.buffer]:[l.quantizedData.buffer],h.buffer]})};
//# sourceMappingURL=sphereWorker-DzlAkcx_.js.map
