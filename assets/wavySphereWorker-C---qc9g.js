var k=1e-6,I=typeof Float32Array<"u"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var n=0,t=arguments.length;t--;)n+=arguments[t]*arguments[t];return Math.sqrt(n)});function j(){var n=new I(9);return I!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[5]=0,n[6]=0,n[7]=0),n[0]=1,n[4]=1,n[8]=1,n}function nn(){var n=new I(16);return I!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=0,n[12]=0,n[13]=0,n[14]=0),n[0]=1,n[5]=1,n[10]=1,n[15]=1,n}function z(){var n=new I(3);return I!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n}function G(n){var t=new I(3);return t[0]=n[0],t[1]=n[1],t[2]=n[2],t}function tn(n){var t=n[0],e=n[1],r=n[2];return Math.hypot(t,e,r)}function x(n,t,e){var r=new I(3);return r[0]=n,r[1]=t,r[2]=e,r}function rn(n,t,e){return n[0]=t[0]-e[0],n[1]=t[1]-e[1],n[2]=t[2]-e[2],n}function V(n,t){var e=t[0],r=t[1],a=t[2],s=e*e+r*r+a*a;return s>0&&(s=1/Math.sqrt(s)),n[0]=t[0]*s,n[1]=t[1]*s,n[2]=t[2]*s,n}function R(n,t){return n[0]*t[0]+n[1]*t[1]+n[2]*t[2]}function m(n,t,e){var r=t[0],a=t[1],s=t[2],o=e[0],c=e[1],i=e[2];return n[0]=a*i-s*c,n[1]=s*o-r*i,n[2]=r*c-a*o,n}var J=rn,en=tn;(function(){var n=z();return function(t,e,r,a,s,o){var c,i;for(e||(e=3),r||(r=0),a?i=Math.min(a*e+r,t.length):i=t.length,c=r;c<i;c+=e)n[0]=t[c],n[1]=t[c+1],n[2]=t[c+2],s(n,n,o),t[c]=n[0],t[c+1]=n[1],t[c+2]=n[2];return t}})();function K(){var n=new I(4);return I!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0,n[3]=0),n}function an(n,t,e,r,a){return n[0]=t,n[1]=e,n[2]=r,n[3]=a,n}function cn(n,t,e){return n[0]=t[0]*e,n[1]=t[1]*e,n[2]=t[2]*e,n[3]=t[3]*e,n}function sn(n,t){var e=t[0],r=t[1],a=t[2],s=t[3],o=e*e+r*r+a*a+s*s;return o>0&&(o=1/Math.sqrt(o)),n[0]=e*o,n[1]=r*o,n[2]=a*o,n[3]=s*o,n}(function(){var n=K();return function(t,e,r,a,s,o){var c,i;for(e||(e=4),r||(r=0),a?i=Math.min(a*e+r,t.length):i=t.length,c=r;c<i;c+=e)n[0]=t[c],n[1]=t[c+1],n[2]=t[c+2],n[3]=t[c+3],s(n,n,o),t[c]=n[0],t[c+1]=n[1],t[c+2]=n[2],t[c+3]=n[3];return t}})();function X(){var n=new I(4);return I!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n[3]=1,n}function on(n,t,e){e=e*.5;var r=Math.sin(e);return n[0]=r*t[0],n[1]=r*t[1],n[2]=r*t[2],n[3]=Math.cos(e),n}function W(n,t,e,r){var a=t[0],s=t[1],o=t[2],c=t[3],i=e[0],h=e[1],u=e[2],M=e[3],f,l,d,y,v;return l=a*i+s*h+o*u+c*M,l<0&&(l=-l,i=-i,h=-h,u=-u,M=-M),1-l>k?(f=Math.acos(l),d=Math.sin(f),y=Math.sin((1-r)*f)/d,v=Math.sin(r*f)/d):(y=1-r,v=r),n[0]=y*a+v*i,n[1]=y*s+v*h,n[2]=y*o+v*u,n[3]=y*c+v*M,n}function Z(n,t){var e=t[0]+t[4]+t[8],r;if(e>0)r=Math.sqrt(e+1),n[3]=.5*r,r=.5/r,n[0]=(t[5]-t[7])*r,n[1]=(t[6]-t[2])*r,n[2]=(t[1]-t[3])*r;else{var a=0;t[4]>t[0]&&(a=1),t[8]>t[a*3+a]&&(a=2);var s=(a+1)%3,o=(a+2)%3;r=Math.sqrt(t[a*3+a]-t[s*3+s]-t[o*3+o]+1),n[a]=.5*r,r=.5/r,n[3]=(t[s*3+o]-t[o*3+s])*r,n[s]=(t[s*3+a]+t[a*3+s])*r,n[o]=(t[o*3+a]+t[a*3+o])*r}return n}var H=cn,_=sn;(function(){var n=z(),t=x(1,0,0),e=x(0,1,0);return function(r,a,s){var o=R(a,s);return o<-.999999?(m(n,t,a),en(n)<1e-6&&m(n,e,a),V(n,n),on(r,n,Math.PI),r):o>.999999?(r[0]=0,r[1]=0,r[2]=0,r[3]=1,r):(m(n,a,s),r[0]=n[0],r[1]=n[1],r[2]=n[2],r[3]=1+o,_(r,r))}})();(function(){var n=X(),t=X();return function(e,r,a,s,o,c){return W(n,r,o,c),W(t,a,s,c),W(e,n,t,2*c*(1-c)),e}})();(function(){var n=j();return function(t,e,r,a){return n[0]=r[0],n[3]=r[1],n[6]=r[2],n[1]=a[0],n[4]=a[1],n[7]=a[2],n[2]=-e[0],n[5]=-e[1],n[8]=-e[2],_(t,Z(t,n))}})();function fn(n,t,e){const r=G(n),a=G(t);V(r,r),V(a,a);const s=Math.abs(r[0])<.9?x(1,0,0):x(0,1,0),o=m(z(),r,s);V(o,o);const c=R(a,o),i=m(z(),o,a),h=R(i,r),M=(Math.atan2(h,c)+Math.PI)/(2*Math.PI),f=Math.round(M*32767)&32767;return(e>0?1:0)<<15|f}var U=(n=>(n.Uncompressed="none",n.Angle16Bits="angle16bits",n.Quaternion12Bits="quaternion12bits",n))(U||{});function ln(n,t,e,r,a,s,o){const c=new Uint16Array(n*8),i=x(1/0,1/0,1/0),h=x(-1/0,-1/0,-1/0);for(let M=0;M<t.length;M+=3)i[0]=Math.min(i[0],t[M]),i[1]=Math.min(i[1],t[M+1]),i[2]=Math.min(i[2],t[M+2]),h[0]=Math.max(h[0],t[M]),h[1]=Math.max(h[1],t[M+1]),h[2]=Math.max(h[2],t[M+2]);const u=J(z(),h,i);for(let M=0;M<n;M++){const f=M*3,l=M*4,d=M*2,y=M*8,v=(t[f]-i[0])/u[0],g=(t[f+1]-i[1])/u[1],A=(t[f+2]-i[2])/u[2];c[y]=v*65535,c[y+1]=g*65535,c[y+2]=A*65535;const q=x(e[f],e[f+1],e[f+2]),T=x(r[l],r[l+1],r[l+2]),P=r[l+3]>0?1:0,w=fn(q,T,P);c[y+3]=w;const F=e[f],B=e[f+1],$=e[f+2],D=1/(Math.abs(F)+Math.abs(B)+Math.abs($));let b=F*D,p=B*D;if($<0){const Q=b;b=(1-Math.abs(p))*(b>=0?1:-1),p=(1-Math.abs(Q))*(p>=0?1:-1)}c[y+4]=(b*.5+.5)*65535|0,c[y+5]=(p*.5+.5)*65535|0,c[y+6]=a[d]*65535|0,c[y+7]=a[d+1]*65535|0}return{compressedData:c,positionMin:i,positionMax:h}}function hn(n,t,e,r,a,s,o){const c=new Uint16Array(n*8),i=x(1/0,1/0,1/0),h=x(-1/0,-1/0,-1/0);for(let l=0;l<t.length;l+=3)i[0]=Math.min(i[0],t[l]),i[1]=Math.min(i[1],t[l+1]),i[2]=Math.min(i[2],t[l+2]),h[0]=Math.max(h[0],t[l]),h[1]=Math.max(h[1],t[l+1]),h[2]=Math.max(h[2],t[l+2]);const u=J(z(),h,i),M=new Uint16Array(n*3),f=K();for(let l=0;l<n;l++){const d=l*3,y=l*4,v=l*2,g=l*8,A=(t[d]-i[0])/u[0],q=(t[d+1]-i[1])/u[1],T=(t[d+2]-i[2])/u[2];c[g]=A*65535,c[g+1]=q*65535,c[g+2]=T*65535;const P=x(e[d],e[d+1],e[d+2]),w=x(r[y],r[y+1],r[y+2]),F=r[y+3]>0?1:0;an(f,w[0],w[1],w[2],F),xn(M,P,f,un),c[g+3]=M[0],c[g+4]=M[1],c[g+5]=M[2],c[g+6]=a[v]*65535|0,c[g+7]=a[v+1]*65535|0}return{compressedData:c,positionMin:i,positionMax:h}}function Mn(n,t,e,r,a){const s=t&4095|(e&15)<<12,o=e>>4&255|(r&255)<<8,c=r>>8&15|(a&4095)<<4;return n[0]=s,n[1]=o,n[2]=c,n}function S(n,t){const e=(1<<t)-1;return Math.round((n*.5+.5)*e)}function vn(n,t,e,r,a){const s=S(t,12),o=S(e,12),c=S(r,12),i=S(a,12);return Mn(n,s,o,c,i)}function yn(n,t,e,r,a,s,o,c,i,h){return n[0]=t,n[1]=e,n[2]=r,n[3]=a,n[4]=s,n[5]=o,n[6]=c,n[7]=i,n[8]=h,n}const un={TMP0:z(),TMP1:z(),TMP2:z(),MAT0:nn(),F0:x(0,0,1),F1:x(2,-2,-2),F2:x(2,2,-2),Q0:x(1,0,0),Q1:x(-2,2,-2),Q2:x(-2,2,2),qTangent:X()};function gn(n,t,e,r,a){const s=m(r.TMP0,t,e),o=yn(r.MAT0,e[0],e[1],e[2],s[0],s[1],s[2],t[0],t[1],t[2]);Z(n,o),_(n,n),n[3]<0&&H(n,n,-1);const c=1/((1<<a-1)-1);if(n[3]<c){n[3]=c;const u=Math.sqrt(1-c*c);n[0]*=u,n[1]*=u,n[2]*=u}const i=e[3]>0?m(r.TMP1,e,t):m(r.TMP1,t,e),h=m(r.TMP2,e,t);return R(h,i)<0&&H(n,n,-1),n}function xn(n,t,e,r){const a=gn(r.qTangent,t,e,r,12);return vn(n,a[0],a[1],a[2],a[3])}self.onmessage=async n=>{const t=performance.now(),{resolution:e,quantizationFormat:r}=n.data,a=(e+1)*(e+1),s=new Float32Array(a*3),o=new Float32Array(a*3),c=new Float32Array(a*4),i=new Float32Array(a*2),h=new Uint32Array(e*e*6),u=8,M=.2;let f=0;for(let v=0;v<=e;v++){const g=v*Math.PI/e,A=Math.sin(g),q=Math.cos(g);for(let T=0;T<=e;T++){const P=T*2*Math.PI/e,w=Math.sin(P),F=Math.cos(P),B=1+M*Math.sin(u*P)*Math.sin(u*g),$=F*A*B,D=q*B,b=w*A*B;s[f*3]=$,s[f*3+1]=D,s[f*3+2]=b;const p=F*A,Q=q,Y=w*A,C=Math.sqrt(p*p+Q*Q+Y*Y);o[f*3]=p/C,o[f*3+1]=Q/C,o[f*3+2]=Y/C;const E=-b,L=0,N=$,O=Math.sqrt(E*E+L*L+N*N);c[f*4]=E/O,c[f*4+1]=L/O,c[f*4+2]=N/O,c[f*4+3]=1,i[f*2]=T/e,i[f*2+1]=v/e,f++}}f=0;for(let v=0;v<e;v++)for(let g=0;g<e;g++){const A=v*(e+1)+g,q=A+e+1;h[f]=A,h[f+1]=q,h[f+2]=A+1,h[f+3]=q,h[f+4]=q+1,h[f+5]=A+1,f+=6}const l={indices:h,vertexBytes:r===U.Uncompressed?3*4+3*4+4*4+2*4:16,numVertices:a};if(r!==U.Uncompressed){let v;switch(r){case U.Quaternion12Bits:v=hn(a,s,o,c,i),l.vertexBytes=16;break;case U.Angle16Bits:default:v=ln(a,s,o,c,i),l.vertexBytes=16;break}l.quantizedData=v.compressedData,l.positionMin=v.positionMin,l.positionMax=v.positionMax}else l.positions=s,l.normals=o,l.tangents=c,l.uvs=i;const y=performance.now()-t;console.log(`Wavy sphere generation took ${y.toFixed(2)}ms`),self.postMessage(l,{transfer:[...r===U.Uncompressed?[s.buffer,o.buffer,c.buffer,i.buffer]:[l.quantizedData.buffer],h.buffer]})};
//# sourceMappingURL=wavySphereWorker-C---qc9g.js.map
