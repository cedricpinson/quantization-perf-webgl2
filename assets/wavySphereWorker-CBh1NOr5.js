var D=typeof Float32Array<"u"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var t=0,n=arguments.length;n--;)t+=arguments[n]*arguments[n];return Math.sqrt(t)});function Y(){var t=new D(3);return D!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function N(t){var n=new D(3);return n[0]=t[0],n[1]=t[1],n[2]=t[2],n}function w(t,n,o){var a=new D(3);return a[0]=t,a[1]=n,a[2]=o,a}function X(t,n,o){return t[0]=n[0]-o[0],t[1]=n[1]-o[1],t[2]=n[2]-o[2],t}function L(t,n){var o=n[0],a=n[1],c=n[2],i=o*o+a*a+c*c;return i>0&&(i=1/Math.sqrt(i)),t[0]=n[0]*i,t[1]=n[1]*i,t[2]=n[2]*i,t}function S(t,n){return t[0]*n[0]+t[1]*n[1]+t[2]*n[2]}function W(t,n,o){var a=n[0],c=n[1],i=n[2],h=o[0],s=o[1],r=o[2];return t[0]=c*r-i*s,t[1]=i*h-a*r,t[2]=a*s-c*h,t}var _=X;(function(){var t=Y();return function(n,o,a,c,i,h){var s,r;for(o||(o=3),a||(a=0),c?r=Math.min(c*o+a,n.length):r=n.length,s=a;s<r;s+=o)t[0]=n[s],t[1]=n[s+1],t[2]=n[s+2],i(t,t,h),n[s]=t[0],n[s+1]=t[1],n[s+2]=t[2];return n}})();function $(t,n,o){const a=N(t),c=N(n);L(a,a),L(c,c);const i=Math.abs(a[0])<.9?w(1,0,0):w(0,1,0),h=W(Y(),a,i);L(h,h);const s=S(c,h),r=W(Y(),h,c),f=S(r,a),l=(Math.atan2(f,s)+Math.PI)/(2*Math.PI),e=Math.round(l*32767)&32767;return(o>0?1:0)<<15|e}function j(t,n,o,a,c,i,h){const s=new Uint16Array(t*8),r=w(1/0,1/0,1/0),f=w(-1/0,-1/0,-1/0);for(let l=0;l<n.length;l+=3)r[0]=Math.min(r[0],n[l]),r[1]=Math.min(r[1],n[l+1]),r[2]=Math.min(r[2],n[l+2]),f[0]=Math.max(f[0],n[l]),f[1]=Math.max(f[1],n[l+1]),f[2]=Math.max(f[2],n[l+2]);const x=_(Y(),f,r);for(let l=0;l<t;l++){const e=l*3,u=l*4,C=l*2,d=l*8,y=(n[e]-r[0])/x[0],g=(n[e+1]-r[1])/x[1],M=(n[e+2]-r[2])/x[2];s[d]=y*65535,s[d+1]=g*65535,s[d+2]=M*65535;const m=w(o[e],o[e+1],o[e+2]),A=w(a[u],a[u+1],a[u+2]),I=a[u+3]>0?1:0,P=$(m,A,I);s[d+3]=P;const b=o[e],z=o[e+1],q=o[e+2],T=1/(Math.abs(b)+Math.abs(z)+Math.abs(q));let p=b*T,v=z*T;if(q<0){const F=p;p=(1-Math.abs(v))*(p>=0?1:-1),v=(1-Math.abs(F))*(v>=0?1:-1)}s[d+4]=(p*.5+.5)*65535|0,s[d+5]=(v*.5+.5)*65535|0,s[d+6]=c[C]*65535|0,s[d+7]=c[C+1]*65535|0}return{compressedData:s,positionMin:r,positionMax:f}}self.onmessage=async t=>{const n=performance.now(),{resolution:o,quantize:a}=t.data,c=(o+1)*(o+1),i=new Float32Array(c*3),h=new Float32Array(c*3),s=new Float32Array(c*4),r=new Float32Array(c*2),f=new Uint32Array(o*o*6),x=8,l=.2;let e=0;for(let y=0;y<=o;y++){const g=y*Math.PI/o,M=Math.sin(g),m=Math.cos(g);for(let A=0;A<=o;A++){const I=A*2*Math.PI/o,P=Math.sin(I),b=Math.cos(I),z=1+l*Math.sin(x*I)*Math.sin(x*g),q=b*M*z,T=m*z,p=P*M*z;i[e*3]=q,i[e*3+1]=T,i[e*3+2]=p;const v=b*M,F=m,R=P*M,U=Math.sqrt(v*v+F*F+R*R);h[e*3]=v/U,h[e*3+1]=F/U,h[e*3+2]=R/U;const V=-p,k=0,B=q,E=Math.sqrt(V*V+k*k+B*B);s[e*4]=V/E,s[e*4+1]=k/E,s[e*4+2]=B/E,s[e*4+3]=1,r[e*2]=A/o,r[e*2+1]=y/o,e++}}e=0;for(let y=0;y<o;y++)for(let g=0;g<o;g++){const M=y*(o+1)+g,m=M+o+1;f[e]=M,f[e+1]=m,f[e+2]=M+1,f[e+3]=m,f[e+4]=m+1,f[e+5]=M+1,e+=6}const u={indices:f,vertexBytes:a?16:3*4+3*4+4*4+2*4,numVertices:c};if(a){const{compressedData:y,positionMin:g,positionMax:M}=j(c,i,h,s,r);u.quantizedData=y,u.positionMin=g,u.positionMax=M}else u.positions=i,u.normals=h,u.tangents=s,u.uvs=r;const d=performance.now()-n;console.log(`Wavy sphere generation took ${d.toFixed(2)}ms`),self.postMessage(u,{transfer:[...a?[u.quantizedData.buffer,f.buffer]:[i.buffer,h.buffer,s.buffer,r.buffer,f.buffer]]})};
//# sourceMappingURL=wavySphereWorker-CBh1NOr5.js.map
