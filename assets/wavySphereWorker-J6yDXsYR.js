var K=1e-6,g=typeof Float32Array<"u"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var n=0,t=arguments.length;t--;)n+=arguments[t]*arguments[t];return Math.sqrt(n)});function Z(){var n=new g(9);return g!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[5]=0,n[6]=0,n[7]=0),n[0]=1,n[4]=1,n[8]=1,n}function q(){var n=new g(16);return g!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=0,n[12]=0,n[13]=0,n[14]=0),n[0]=1,n[5]=1,n[10]=1,n[15]=1,n}function b(){var n=new g(3);return g!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n}function X(n){var t=new g(3);return t[0]=n[0],t[1]=n[1],t[2]=n[2],t}function j(n){var t=n[0],e=n[1],r=n[2];return Math.hypot(t,e,r)}function d(n,t,e){var r=new g(3);return r[0]=n,r[1]=t,r[2]=e,r}function nn(n,t,e){return n[0]=t[0]-e[0],n[1]=t[1]-e[1],n[2]=t[2]-e[2],n}function V(n,t){var e=t[0],r=t[1],a=t[2],o=e*e+r*r+a*a;return o>0&&(o=1/Math.sqrt(o)),n[0]=t[0]*o,n[1]=t[1]*o,n[2]=t[2]*o,n}function R(n,t){return n[0]*t[0]+n[1]*t[1]+n[2]*t[2]}function T(n,t,e){var r=t[0],a=t[1],o=t[2],i=e[0],c=e[1],s=e[2];return n[0]=a*s-o*c,n[1]=o*i-r*s,n[2]=r*c-a*i,n}var k=nn,tn=j;(function(){var n=b();return function(t,e,r,a,o,i){var c,s;for(e||(e=3),r||(r=0),a?s=Math.min(a*e+r,t.length):s=t.length,c=r;c<s;c+=e)n[0]=t[c],n[1]=t[c+1],n[2]=t[c+2],o(n,n,i),t[c]=n[0],t[c+1]=n[1],t[c+2]=n[2];return t}})();function rn(){var n=new g(4);return g!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0,n[3]=0),n}function en(n,t,e,r){var a=new g(4);return a[0]=n,a[1]=t,a[2]=e,a[3]=r,a}function an(n,t,e){return n[0]=t[0]*e,n[1]=t[1]*e,n[2]=t[2]*e,n[3]=t[3]*e,n}function cn(n,t){var e=t[0],r=t[1],a=t[2],o=t[3],i=e*e+r*r+a*a+o*o;return i>0&&(i=1/Math.sqrt(i)),n[0]=e*i,n[1]=r*i,n[2]=a*i,n[3]=o*i,n}(function(){var n=rn();return function(t,e,r,a,o,i){var c,s;for(e||(e=4),r||(r=0),a?s=Math.min(a*e+r,t.length):s=t.length,c=r;c<s;c+=e)n[0]=t[c],n[1]=t[c+1],n[2]=t[c+2],n[3]=t[c+3],o(n,n,i),t[c]=n[0],t[c+1]=n[1],t[c+2]=n[2],t[c+3]=n[3];return t}})();function O(){var n=new g(4);return g!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n[3]=1,n}function sn(n,t,e){e=e*.5;var r=Math.sin(e);return n[0]=r*t[0],n[1]=r*t[1],n[2]=r*t[2],n[3]=Math.cos(e),n}function H(n,t,e,r){var a=t[0],o=t[1],i=t[2],c=t[3],s=e[0],h=e[1],y=e[2],l=e[3],f,M,I,u,v;return M=a*s+o*h+i*y+c*l,M<0&&(M=-M,s=-s,h=-h,y=-y,l=-l),1-M>K?(f=Math.acos(M),I=Math.sin(f),u=Math.sin((1-r)*f)/I,v=Math.sin(r*f)/I):(u=1-r,v=r),n[0]=u*a+v*s,n[1]=u*o+v*h,n[2]=u*i+v*y,n[3]=u*c+v*l,n}function G(n,t){var e=t[0]+t[4]+t[8],r;if(e>0)r=Math.sqrt(e+1),n[3]=.5*r,r=.5/r,n[0]=(t[5]-t[7])*r,n[1]=(t[6]-t[2])*r,n[2]=(t[1]-t[3])*r;else{var a=0;t[4]>t[0]&&(a=1),t[8]>t[a*3+a]&&(a=2);var o=(a+1)%3,i=(a+2)%3;r=Math.sqrt(t[a*3+a]-t[o*3+o]-t[i*3+i]+1),n[a]=.5*r,r=.5/r,n[3]=(t[o*3+i]-t[i*3+o])*r,n[o]=(t[o*3+a]+t[a*3+o])*r,n[i]=(t[i*3+a]+t[a*3+i])*r}return n}var J=an,W=cn;(function(){var n=b(),t=d(1,0,0),e=d(0,1,0);return function(r,a,o){var i=R(a,o);return i<-.999999?(T(n,t,a),tn(n)<1e-6&&T(n,e,a),V(n,n),sn(r,n,Math.PI),r):i>.999999?(r[0]=0,r[1]=0,r[2]=0,r[3]=1,r):(T(n,a,o),r[0]=n[0],r[1]=n[1],r[2]=n[2],r[3]=1+i,W(r,r))}})();(function(){var n=O(),t=O();return function(e,r,a,o,i,c){return H(n,r,i,c),H(t,a,o,c),H(e,n,t,2*c*(1-c)),e}})();(function(){var n=Z();return function(t,e,r,a){return n[0]=r[0],n[3]=r[1],n[6]=r[2],n[1]=a[0],n[4]=a[1],n[7]=a[2],n[2]=-e[0],n[5]=-e[1],n[8]=-e[2],W(t,G(t,n))}})();function on(n,t,e){const r=X(n),a=X(t);V(r,r),V(a,a);const o=Math.abs(r[0])<.9?d(1,0,0):d(0,1,0),i=T(b(),r,o);V(i,i);const c=R(a,i),s=T(b(),i,a),h=R(s,r),l=(Math.atan2(h,c)+Math.PI)/(2*Math.PI),f=Math.round(l*32767)&32767;return(e>0?1:0)<<15|f}const fn=8;var S=(n=>(n.Uncompressed="none",n.Angle16Bits="angle16bits",n.Quaternion12Bits="quaternion12bits",n))(S||{});function ln(n,t,e,r,a,o,i){const c=new Uint16Array(n*8),s=d(1/0,1/0,1/0),h=d(-1/0,-1/0,-1/0);for(let l=0;l<t.length;l+=3)s[0]=Math.min(s[0],t[l]),s[1]=Math.min(s[1],t[l+1]),s[2]=Math.min(s[2],t[l+2]),h[0]=Math.max(h[0],t[l]),h[1]=Math.max(h[1],t[l+1]),h[2]=Math.max(h[2],t[l+2]);const y=k(b(),h,s);for(let l=0;l<n;l++){const f=l*3,M=l*4,I=l*2,u=l*8,v=(t[f]-s[0])/y[0],A=(t[f+1]-s[1])/y[1],x=(t[f+2]-s[2])/y[2];c[u]=v*65535,c[u+1]=A*65535,c[u+2]=x*65535;const m=d(e[f],e[f+1],e[f+2]),p=d(r[M],r[M+1],r[M+2]),$=r[M+3]>0?1:0,w=on(m,p,$);c[u+3]=w;const z=e[f],P=e[f+1],U=e[f+2],Q=1/(Math.abs(z)+Math.abs(P)+Math.abs(U));let B=z*Q,F=P*Q;if(U<0){const D=B;B=(1-Math.abs(F))*(B>=0?1:-1),F=(1-Math.abs(D))*(F>=0?1:-1)}c[u+4]=(B*.5+.5)*65535|0,c[u+5]=(F*.5+.5)*65535|0,c[u+6]=a[I]*65535|0,c[u+7]=a[I+1]*65535|0}return{compressedData:c,positionMin:s,positionMax:h}}function hn(n,t,e,r,a,o,i){const c=new Uint16Array(n*8),s=d(1/0,1/0,1/0),h=d(-1/0,-1/0,-1/0);for(let l=0;l<t.length;l+=3)s[0]=Math.min(s[0],t[l]),s[1]=Math.min(s[1],t[l+1]),s[2]=Math.min(s[2],t[l+2]),h[0]=Math.max(h[0],t[l]),h[1]=Math.max(h[1],t[l+1]),h[2]=Math.max(h[2],t[l+2]);const y=k(b(),h,s);for(let l=0;l<n;l++){const f=l*3,M=l*4,I=l*2,u=l*8,v=(t[f]-s[0])/y[0],A=(t[f+1]-s[1])/y[1],x=(t[f+2]-s[2])/y[2];c[u]=v*65535,c[u+1]=A*65535,c[u+2]=x*65535;const m=d(e[f],e[f+1],e[f+2]),p=d(r[M],r[M+1],r[M+2]),$=r[M+3]>0?1:0,w=dn(O(),m,en(p[0],p[1],p[2],$),yn),z=[Math.round((w[0]*.5+.5)*4095),Math.round((w[1]*.5+.5)*4095),Math.round((w[2]*.5+.5)*4095),Math.round((w[3]*.5+.5)*4095)],[P,U,Q]=Mn(z[0],z[1],z[2],z[3]);c[u+3]=P,c[u+4]=U,c[u+5]=Q,c[u+6]=a[I]*65535|0,c[u+7]=a[I+1]*65535|0}return{compressedData:c,positionMin:s,positionMax:h}}function Mn(n,t,e,r){const a=n&4095|(t&15)<<12,o=t>>4&255|(e&255)<<8,i=e>>8&15|(r&4095)<<4;return[a,o,i]}function un(n,t,e,r,a,o,i,c,s,h){return n[0]=t,n[1]=e,n[2]=r,n[3]=a,n[4]=o,n[5]=i,n[6]=c,n[7]=s,n[8]=h,n}function vn(n){return n[3]<0?J(n,n,-1):n}const yn={TMP0:b(),TMP1:b(),TMP2:b(),MAT0:q(),F0:d(0,0,1),F1:d(2,-2,-2),F2:d(2,2,-2),Q0:d(1,0,0),Q1:d(-2,2,-2),Q2:d(-2,2,2)};function dn(n,t,e,r){const a=T(r.TMP0,t,e),o=un(r.MAT0,e[0],e[1],e[2],a[0],a[1],a[2],t[0],t[1],t[2]);n=G(n,o),n=W(n,n),n=vn(n);const c=1/((1<<2*fn-1)-1);if(n[3]<c){n[3]=c;const y=Math.sqrt(1-c*c);n[0]*=y,n[1]*=y,n[2]*=y}const s=e[3]>0?T(r.TMP1,e,t):T(r.TMP1,t,e),h=T(r.TMP2,e,t);return R(h,s)<0&&J(n,n,-1),n}self.onmessage=async n=>{const t=performance.now(),{resolution:e,quantizationFormat:r}=n.data,a=(e+1)*(e+1),o=new Float32Array(a*3),i=new Float32Array(a*3),c=new Float32Array(a*4),s=new Float32Array(a*2),h=new Uint32Array(e*e*6),y=8,l=.2;let f=0;for(let v=0;v<=e;v++){const A=v*Math.PI/e,x=Math.sin(A),m=Math.cos(A);for(let p=0;p<=e;p++){const $=p*2*Math.PI/e,w=Math.sin($),z=Math.cos($),P=1+l*Math.sin(y*$)*Math.sin(y*A),U=z*x*P,Q=m*P,B=w*x*P;o[f*3]=U,o[f*3+1]=Q,o[f*3+2]=B;const F=z*x,D=m,C=w*x,Y=Math.sqrt(F*F+D*D+C*C);i[f*3]=F/Y,i[f*3+1]=D/Y,i[f*3+2]=C/Y;const E=-B,L=0,N=U,_=Math.sqrt(E*E+L*L+N*N);c[f*4]=E/_,c[f*4+1]=L/_,c[f*4+2]=N/_,c[f*4+3]=1,s[f*2]=p/e,s[f*2+1]=v/e,f++}}f=0;for(let v=0;v<e;v++)for(let A=0;A<e;A++){const x=v*(e+1)+A,m=x+e+1;h[f]=x,h[f+1]=m,h[f+2]=x+1,h[f+3]=m,h[f+4]=m+1,h[f+5]=x+1,f+=6}const M={indices:h,vertexBytes:r===S.Uncompressed?3*4+3*4+4*4+2*4:16,numVertices:a};if(r!==S.Uncompressed){let v;switch(r){case S.Quaternion12Bits:v=hn(a,o,i,c,s),M.vertexBytes=16;break;case S.Angle16Bits:default:v=ln(a,o,i,c,s),M.vertexBytes=16;break}M.quantizedData=v.compressedData,M.positionMin=v.positionMin,M.positionMax=v.positionMax}else M.positions=o,M.normals=i,M.tangents=c,M.uvs=s;const u=performance.now()-t;console.log(`Wavy sphere generation took ${u.toFixed(2)}ms`),self.postMessage(M,{transfer:[...r===S.Uncompressed?[o.buffer,i.buffer,c.buffer,s.buffer]:[M.quantizedData.buffer],h.buffer]})};
//# sourceMappingURL=wavySphereWorker-J6yDXsYR.js.map
